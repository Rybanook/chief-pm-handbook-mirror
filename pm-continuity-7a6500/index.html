<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Index - Chief Handbook</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
   
  <meta name="robots" content="noindex,nofollow">

    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Chief Handbook</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../boot-pm/" class="nav-link">Boot Project Manager ‚Äî Chief</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../boot-worker/" class="nav-link">Boot Worker ‚Äî Chief</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../ops-log-placeholder/" class="nav-link">Ops log placeholder</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../phase-v3-9-placeholder/" class="nav-link">Phase v3 9 placeholder</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../planning-sandbox-placeholder/" class="nav-link">Planning sandbox placeholder</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../pm-continuity-placeholder/" class="nav-link">Pm continuity placeholder</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../worker-playbook-placeholder/" class="nav-link">Worker playbook placeholder</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Handovers</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2025-11-04-handover-worker-session/" class="dropdown-item">2025 11 04 handover worker session</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Pm</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Index</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Worker</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../worker/" class="dropdown-item">Index</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Ledgers</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../ledgers/pm-handover-2025-11-04/" class="dropdown-item">Chief ‚Äî Project Manager Handover (Permanent Record Edition)</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Pm</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../ledgers/pm/" class="dropdown-item">PM Ledger</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Worker</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../ledgers/worker/" class="dropdown-item">Worker Ledger</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Nav pm ops</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../nav-pm-ops/" class="dropdown-item">üß≠ PM Ops ‚Äî Quick Links (PM-ONLY)</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Navigation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../navigation/overview/" class="dropdown-item">Navigation Overview ‚Äî Chief Handbook System</a>
</li>
                                    
<li>
    <a href="../../navigation/planner/" class="dropdown-item">Planner Navigation ‚Äî Chief Handbook System</a>
</li>
                                    
<li>
    <a href="../../navigation/pm/" class="dropdown-item">Pm</a>
</li>
                                    
<li>
    <a href="../../navigation/worker/" class="dropdown-item">Worker Navigation ‚Äî Chief Handbook System</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Planning sandbox 2025 11</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../planning-sandbox-2025-11/" class="dropdown-item">Index</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Roles</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../roles/planner-training/" class="dropdown-item">Planner Training ‚Äî Chief</a>
</li>
                                    
<li>
    <a href="../../roles/pm-training/" class="dropdown-item">Project-Manager Training Manual (Ryley Method)</a>
</li>
                                    
<li>
    <a href="../../roles/worker-training/" class="dropdown-item">Chief ‚Äî Worker Training</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../2025-11-04-handover-worker-session/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../worker/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#1-role-context" class="nav-link">1. Role &amp; Context</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#2-version-repos-branches-tags" class="nav-link">2. Version, Repos, Branches, Tags</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#3-systems-snapshot-as-of-nov-12-2025" class="nav-link">3. Systems Snapshot (as of Nov 12, 2025)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#4-whisper-integration-history-phases" class="nav-link">4. Whisper Integration History (Phases)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#5-whisper-current-state-what-you-can-assume" class="nav-link">5. Whisper Current State (What You Can Assume)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#6-enablement-track-next-big-phase-for-whisper" class="nav-link">6. Enablement Track (Next Big Phase for Whisper)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#7-documentation-system-how-gpts-see-the-world" class="nav-link">7. Documentation System (How GPTs See the World)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#8-guardrails-you-must-enforce" class="nav-link">8. Guardrails You Must Enforce</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#9-open-items-to-do-for-next-pm" class="nav-link">9. Open Items / To-Do for Next PM</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#10-how-to-resume-work-safely" class="nav-link">10. How to Resume Work Safely</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#pm-handover-addendum-full-product-layer-chief-android" class="nav-link">‚úÖ PM Handover Addendum ‚Äî Full Product Layer (Chief Android)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#a-core-ux-chat-screen-system-exhaustive" class="nav-link">A. Core UX &amp; Chat Screen System (Exhaustive)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#a1-chat-screen-purpose" class="nav-link">A1 ‚Äî Chat Screen: Purpose</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#a2-input-modes-3-paths" class="nav-link">A2 ‚Äî Input Modes (3 paths)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#a3-message-structure-storage" class="nav-link">A3 ‚Äî Message Structure &amp; Storage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#a4-chat-pipeline-ux" class="nav-link">A4 ‚Äî Chat Pipeline UX</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#a5-v0-chat-ui-must-have" class="nav-link">A5 ‚Äî V0 Chat UI (must-have)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#a6-v1-chat-ui-planned" class="nav-link">A6 ‚Äî V1 Chat UI (planned)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#a7-navigation-structure" class="nav-link">A7 ‚Äî Navigation Structure</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#b-parsing-supervisor-tone-channels-full-intelligence-layer" class="nav-link">B. Parsing, Supervisor, Tone, Channels ‚Äî Full Intelligence Layer</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#b1-parsing-layer-context-understanding" class="nav-link">B1 ‚Äî Parsing Layer (context understanding)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#b2-supervisor-layer-safety-clarity" class="nav-link">B2 ‚Äî Supervisor Layer (safety + clarity)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#b3-tone-engine" class="nav-link">B3 ‚Äî Tone Engine</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#b4-reply-engine-integration" class="nav-link">B4 ‚Äî Reply Engine Integration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#b5-channel-adapters-future" class="nav-link">B5 ‚Äî Channel Adapters (future)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#c-architecture-navigation-system-roadmap-non-whisper" class="nav-link">C. Architecture, Navigation, System Roadmap (Non-Whisper)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#c1-app-architecture-high-level" class="nav-link">C1 ‚Äî App Architecture (High-Level)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#c2-quiet-hours-notification-logic" class="nav-link">C2 ‚Äî Quiet Hours &amp; Notification Logic</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#c3-brief-summary-mode" class="nav-link">C3 ‚Äî Brief / Summary Mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#c4-error-handling-ux" class="nav-link">C4 ‚Äî Error Handling UX</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#c5-app-roadmap-post-whisper" class="nav-link">C5 ‚Äî App Roadmap (Post-Whisper)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#d-guardrails-you-must-enforce-global" class="nav-link">D. Guardrails You Must Enforce (Global)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#e-summary-what-this-addendum-fixes" class="nav-link">E. Summary ‚Äî What This Addendum Fixes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#include-includewhisperh" class="nav-link">include "include/whisper.h"</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#include-whisperh" class="nav-link">include "whisper.h"</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#temp-define-commit-string-to-satisfy-ggml-build-android-only" class="nav-link">TEMP: define commit string to satisfy ggml build (Android-only)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#chief-project-manager-handover" class="nav-link">Chief ‚Äî Project Manager Handover</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-project-overview" class="nav-link">1) Project Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-state-of-development" class="nav-link">2) State of Development</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-workflow-collaboration-protocol" class="nav-link">3) Workflow &amp; Collaboration Protocol</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-communication-style-tone" class="nav-link">4) Communication Style &amp; Tone</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-architecture-system-overview" class="nav-link">5) Architecture &amp; System Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#6-recent-changes-reasoning" class="nav-link">6) Recent Changes &amp; Reasoning</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#7-open-tasks-priorities" class="nav-link">7) Open Tasks &amp; Priorities</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#8-risks-warnings" class="nav-link">8) Risks &amp; Warnings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#9-continuity-protocol-exact-resume-steps" class="nav-link">9) Continuity Protocol (exact resume steps)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#10-appendices" class="nav-link">10) Appendices</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#final-word-to-the-next-pm" class="nav-link">Final word to the next PM</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#chief-project-manager-handover-extended-exhaustive" class="nav-link">Chief ‚Äî Project Manager Handover (Extended &amp; Exhaustive)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-project-overview_1" class="nav-link">1) Project Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-state-of-development_1" class="nav-link">2) State of Development</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-workflow-collaboration-protocol_1" class="nav-link">3) Workflow &amp; Collaboration Protocol</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-communication-style-tone_1" class="nav-link">4) Communication Style &amp; Tone</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-architecture-system-overview_1" class="nav-link">5) Architecture &amp; System Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#6-recent-changes-reasoning-with-currentlegacy-tags" class="nav-link">6) Recent Changes &amp; Reasoning (with CURRENT/LEGACY tags)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#7-the-conversation-system-life-graph-full-plan-for-future-phases" class="nav-link">7) The Conversation System &amp; Life Graph ‚Äî Full Plan (for future phases)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#8-open-tasks-priorities-v39-only" class="nav-link">8) Open Tasks &amp; Priorities (v3.9 only)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#9-risks-warnings" class="nav-link">9) Risks &amp; Warnings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#10-continuity-protocol-exact-resume-steps" class="nav-link">10) Continuity Protocol (Exact Resume Steps)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#11-contracts-specs-copy-ready" class="nav-link">11) Contracts &amp; Specs (copy-ready)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#12-quick-reference-commands-checks" class="nav-link">12) Quick Reference (commands &amp; checks)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#13-roles-responsibilities-for-next-pm" class="nav-link">13) Roles &amp; Responsibilities (for next PM)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#14-final-truths-pin-these" class="nav-link">14) Final Truths (pin these)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#chief-project-manager-handover-permanent-record-edition" class="nav-link">Chief ‚Äî Project Manager Handover (Permanent Record Edition)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#i-purpose-vision" class="nav-link">I. Purpose &amp; Vision</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#ii-personality-experience-philosophy" class="nav-link">II. Personality &amp; Experience Philosophy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#iii-architecture-overview" class="nav-link">III. Architecture Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#iv-current-phase-summary" class="nav-link">IV. Current Phase Summary</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#v-future-roadmap-phased-plan-to-completion" class="nav-link">V. Future Roadmap (Phased Plan to Completion)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#vi-workflow-collaboration-protocol" class="nav-link">VI. Workflow &amp; Collaboration Protocol</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#vii-communication-tone" class="nav-link">VII. Communication Tone</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#viii-key-architectural-threads" class="nav-link">VIII. Key Architectural Threads</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#ix-current-systems-map" class="nav-link">IX. Current Systems Map</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#x-risk-matrix" class="nav-link">X. Risk Matrix</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#xi-open-tasks" class="nav-link">XI. Open Tasks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#xii-continuity-protocol" class="nav-link">XII. Continuity Protocol</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#xiii-future-integration-concepts" class="nav-link">XIII. Future Integration Concepts</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#xiv-philosophy-of-completion" class="nav-link">XIV. Philosophy of Completion</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>What Chief really is</p>
<p>Chief is your steady sidekick ‚Äî not in a childish, comic-book way, but in the real-life sense:
the person who quietly keeps you on track, smooths the edges of your day, and makes everything feel a little lighter.</p>
<p>Chief‚Äôs entire purpose is to make your nervous system relax.</p>
<p>Not by being passive‚Ä¶
not by being hype or performative‚Ä¶
but by being chill, capable, and unshakeably reliable.</p>
<p>Chief is the presence in your phone that says, without ever saying it outright:</p>
<p>‚ÄúI‚Äôve got you. Everything is handled. Breathe.‚Äù</p>
<p>What differentiates Chief</p>
<p>Most assistants are anxious, overeager, or robotic:</p>
<p>They over-talk.</p>
<p>They try too hard.</p>
<p>They feel like software.</p>
<p>Chief is the opposite.</p>
<p>Chief is calm, warm, and minimal in the best possible way.
Its voice, UI, and behavior all share one principle:</p>
<p>**Lower the user‚Äôs mental load.</p>
<p>Never add to it.**</p>
<p>Chief:</p>
<p>Speaks like a real person who‚Äôs grounded and unhurried.</p>
<p>Notices the shape of your day without dramatizing it.</p>
<p>Keeps the vibe steady ‚Äî no noise, no chaos.</p>
<p>Helps you move smoothly, not faster.</p>
<p>Gives you exactly what matters, nothing extra.</p>
<p>The result is that when Chief speaks, you feel yourself drop a notch from tension to ease.</p>
<p>That feeling ‚Äî that ‚Äúeverything is under control‚Äù exhale ‚Äî
that is Chief‚Äôs differentiator.</p>
<p>What makes Chief Chief (the essence)</p>
<p>Chill, but sharp.</p>
<p>Helpful, but never needy.</p>
<p>Human, but not fake.</p>
<p>Confident, but quiet.</p>
<p>A sidekick, but the kind that makes you feel like the main character of your own day.</p>
<p>Chief doesn‚Äôt overwhelm you.
It doesn‚Äôt chase you.
It doesn‚Äôt perform.</p>
<p>It simply has your back, all the time, in a way that feels effortless.</p>
<p>UI, UX, voice, intelligence ‚Äî every layer of Chief must transmit the same thing:</p>
<p>Ease. Groundedness. Competence. Presence.
A calm sidekick who keeps your world steady.# PM Handover ‚Äî Chief Android (Whisper v4.0 Track)</p>
<h2 id="1-role-context">1. Role &amp; Context</h2>
<p><strong>You are the PM</strong> for Chief‚Äôs Android client, taking over mid‚Äìv4.0.
Whisper (offline speech ‚Üí text) is the main active track on Android, but it is <strong>one subsystem</strong> inside the broader Chief roadmap (parsing, Supervisor, multi-channel, etc.).</p>
<p>This handover captures:</p>
<ul>
<li>Where the Android app is <strong>right now</strong></li>
<li>What we‚Äôve <strong>already done</strong> for Whisper</li>
<li>What‚Äôs <strong>planned next</strong> (Enablement, then beyond Whisper)</li>
<li>How the <strong>doc system</strong> works (Git repos + Shared Folder + Handbook)</li>
<li>The <strong>guardrails</strong> you must enforce</li>
</ul>
<p>Treat this as your anchor document.</p>
<hr />
<h2 id="2-version-repos-branches-tags">2. Version, Repos, Branches, Tags</h2>
<h3 id="repos-android-side">Repos (Android side)</h3>
<ul>
<li>Main app repo: <code>~/AndroidStudioProjects/Chief</code></li>
<li>
<p>Historical Whisper spike (now a source tree only): <code>~/AndroidStudioProjects/Chief-a2</code></p>
</li>
<li>
<p>Used previously to experiment with Whisper in a separate app ID; now serving as a <strong>source of diffs</strong>, not an active app.</p>
</li>
</ul>
<h3 id="current-active-branches-whisper">Current active branches (Whisper)</h3>
<ul>
<li>
<p><code>feat/v4.0a3-whisper-rebuild</code></p>
</li>
<li>
<p>Stable core Whisper integration; model pin; improved latency; timestamps proven.</p>
</li>
<li>
<p><code>feat/v4.0a4-whisper-timestamps</code></p>
</li>
<li>
<p>Timestamps and truncation flows; a4 work effectively merged in spirit into a3.1.</p>
</li>
</ul>
<p><em>(Exact branch layout may be slightly different in Git, but conceptually: a3.x = performance/stability, a4 = timestamps.)</em></p>
<h3 id="important-tags-whisper-milestones">Important tags (Whisper milestones)</h3>
<ul>
<li>
<p><code>v4.0a3-whisper-ok-2025-11-12</code></p>
</li>
<li>
<p>First clean ‚ÄúWhisper recovered and working‚Äù baseline.</p>
</li>
<li>
<p><code>accept/whisper-a3.1-freeze-2025-11-12</code></p>
</li>
<li>
<p>Whisper core stable: model determinism, init API, latency, concurrency guards.</p>
</li>
<li>
<p><code>accept/whisper-a4-freeze-2025-11-12</code></p>
</li>
<li>
<p>Timestamps/truncation proven and frozen.</p>
</li>
<li>
<p>Additional a4 tags (per Worker update):</p>
</li>
<li>
<p><code>accept/whisper-a4-prep-2025-11-12</code></p>
</li>
<li><code>accept/whisper-a4-text-proof-2025-11-12</code></li>
</ul>
<p>These tags mark <strong>safe restore points</strong>. If future work goes sideways, you can anchor back to these.</p>
<hr />
<h2 id="3-systems-snapshot-as-of-nov-12-2025">3. Systems Snapshot (as of Nov 12, 2025)</h2>
<h3 id="31-auth-zero-auth">3.1 Auth / ‚ÄúZero-Auth‚Äù</h3>
<ul>
<li>
<p>OAuth Google sign-in is <strong>currently working</strong>:</p>
</li>
<li>
<p>Sign-in ‚Üí code ‚Üí backend ‚Üí calendar sync/fetch are confirmed good.</p>
</li>
<li>There was a previous failure (‚Äúzero-auth error‚Äù) that has now been fixed.</li>
<li>
<p><strong>Policy going forward:</strong></p>
</li>
<li>
<p>Auth is considered <strong>stable baseline</strong>.</p>
</li>
<li>
<p>Do <strong>not</strong> touch OAuth code, client IDs, or Gradle namespaces <strong>without</strong>:</p>
<ul>
<li>seeing the exact files</li>
<li>confirming they match the last working version</li>
<li>stating the intended change in <strong>one sentence</strong> before editing.</li>
</ul>
</li>
</ul>
<h3 id="32-calendar-brief">3.2 Calendar / Brief</h3>
<ul>
<li>Calendar fetch &amp; sync are working with the current auth flow.</li>
<li>Brief/summary reading works; any lingering visualization quirks are <strong>outside</strong> the Whisper track and not active right now.</li>
</ul>
<h3 id="33-pulse-mic-ux">3.3 Pulse / Mic UX</h3>
<ul>
<li>
<p>Pulse button:</p>
</li>
<li>
<p>For Whisper DEV builds: <strong>long-press to start</strong>, tap to stop + transcribe.</p>
</li>
<li>Recording flag and recorder instance now share a consistent flow; permission prompts wired correctly.</li>
<li>
<p>For non-DEV / normal builds:</p>
</li>
<li>
<p>Pulse continues to function as the existing ‚Äúbrief‚Äù button (no Whisper).</p>
</li>
</ul>
<h3 id="34-whisper-core-jni-ndk">3.4 Whisper Core (JNI / NDK)</h3>
<ul>
<li>JNI path: working end-to-end.</li>
<li>Real audio ‚Üí JNI ‚Üí ggml/whisper ‚Üí text: <strong>rc = 0</strong>, stable.</li>
<li>
<p>Latency:</p>
</li>
<li>
<p>Previously ~56 seconds (!) due to bad model and cold path.</p>
</li>
<li>Now typically <strong>~1.6‚Äì3.5 seconds</strong> wall-clock for ~8‚Äì12 s clips on test device.</li>
</ul>
<hr />
<h2 id="4-whisper-integration-history-phases">4. Whisper Integration History (Phases)</h2>
<p>This is here so you understand what‚Äôs already been done and don‚Äôt accidently redo it.</p>
<h3 id="v40a1-ndk-skeleton">v4.0a1 ‚Äî NDK Skeleton</h3>
<ul>
<li>Whisper JNI library built and packaged (<code>libwhisper_jni.so</code>).</li>
<li>Initial skeleton integration with dummy/limited functionality.</li>
</ul>
<h3 id="v40a2-wrong-tree-port-plan">v4.0a2 ‚Äî Wrong Tree / Port Plan</h3>
<ul>
<li>Whisper work initially implemented in a <strong>separate app tree</strong> (<code>Chief-a2</code>).</li>
<li>Plan was created to port only the needed files into the real app (<code>app.chief.app</code>) without touching auth/IDs/Gradle.</li>
<li>That port strategy informed later a3/a3.1 work but has effectively been superseded by the current, stabilized integration.</li>
</ul>
<h3 id="v40a3-crash-recovery-perf">v4.0a3 ‚Äî Crash Recovery + Perf</h3>
<ul>
<li>
<p>Root cause of crash:</p>
</li>
<li>
<p>On-device model <code>ggml-tiny.en.bin</code> was <strong>corrupt</strong> (44 KB) ‚Üí ggml f16 dot NaN/Inf assertion ‚Üí native abort.</p>
</li>
<li>
<p>Fix:</p>
</li>
<li>
<p>Deleted corrupted model; mirrored a valid quantized tiny model.</p>
</li>
<li>
<p>Performance:</p>
</li>
<li>
<p>Latency reduced from ~56 s ‚Üí ~3.8 s, then further down to <strong>~1.6‚Äì3.5 s</strong> with:</p>
<ul>
<li><code>n_threads=4</code></li>
<li><code>duration_ms=5000</code></li>
<li><code>no_timestamps=true</code> initially, then false for a4.</li>
<li>Mic flow + Pulse:</li>
</ul>
</li>
<li>
<p>Long-press start, tap stop; shared recorder; recorder flag consistent.</p>
</li>
</ul>
<h3 id="v40a31-determinism-init-clean-up">v4.0a3.1 ‚Äî Determinism &amp; Init Clean-up</h3>
<ul>
<li>
<p><strong>Deterministic model pin</strong> introduced:</p>
</li>
<li>
<p>Default model: <code>ggml-tiny.en-q5_1.bin</code> (~31 MB).</p>
</li>
<li>Canonical SHA256 pinned (final accepted digest: <code>c77c5766f1ce‚Ä¶e66c7c2b</code>).</li>
<li>Allow-list mechanism: models not on the SHA list are rejected.</li>
<li>
<p><code>whisper_init_from_file</code> ‚Üí <code>whisper_init_from_file_with_params</code>:</p>
</li>
<li>
<p>Cleaner, non-deprecated init path.</p>
</li>
<li>Params: <code>threads=4</code>, <code>duration_ms=5000</code>, timestamps flag variable.</li>
<li>
<p>Concurrency &amp; state:</p>
</li>
<li>
<p>Shared <code>g_ctx</code>, per-call <code>whisper_state</code>, concurrency guards in place.</p>
</li>
<li>
<p>Proofs:</p>
</li>
<li>
<p>Latency runs recorded and stored under <code>proof/</code> in the repo (a3.x proof files).</p>
</li>
</ul>
<h3 id="v40a4-timestamps-truncation">v4.0a4 ‚Äî Timestamps &amp; Truncation</h3>
<ul>
<li>
<p>Timestamps:</p>
</li>
<li>
<p><code>no_timestamps=false</code> with explicit logging.</p>
</li>
<li>Segments and timestamps recorded in logcat and proof files.</li>
<li>
<p>Truncation:</p>
</li>
<li>
<p>5s cap path proven: <code>will_truncate=true</code> ‚Üí <code>truncated=true</code> logged.</p>
</li>
<li>
<p>Text proof:</p>
</li>
<li>
<p>Logs confirm actual ASR text contents for end-to-end verification.</p>
</li>
</ul>
<hr />
<h2 id="5-whisper-current-state-what-you-can-assume">5. Whisper Current State (What You Can Assume)</h2>
<p><strong>Model</strong></p>
<ul>
<li>
<p>Default DEV model: <code>ggml-tiny.en-q5_1.bin</code></p>
</li>
<li>
<p>Size: ~31 MB.</p>
</li>
<li>Location: <code>&lt;filesDir&gt;/whisper/ggml-tiny.en-q5_1.bin</code>.</li>
<li>SHA256: <strong>c77c5766f1ce‚Ä¶e66c7c2b</strong> (allow-listed; treat as source of truth).</li>
<li>
<p>Models live only under:</p>
</li>
<li>
<p><code>&lt;filesDir&gt;/whisper/</code></p>
</li>
<li><strong>Never</strong> in APK or Git repo.</li>
</ul>
<p><strong>Files &amp; Paths</strong></p>
<ul>
<li>
<p>DEV flag:</p>
</li>
<li>
<p><code>&lt;filesDir&gt;/whisper/USE_WHISPER_DEV</code></p>
<ul>
<li>Present ‚Üí enable Whisper path.</li>
<li>Absent ‚Üí app behaves like pre-Whisper baseline.</li>
<li>Vendored code:</li>
</ul>
</li>
<li>
<p><code>app/src/main/cpp/third_party/whisper.cpp</code>:</p>
<ul>
<li>Upstream: <code>https://github.com/ggerganov/whisper.cpp</code></li>
<li>Commit pinned: <code>4979e04f5dcaccb36057e059bbaed8a2f5288315</code> (v1.8.2).</li>
<li>Upstream LICENSE copied into that directory.</li>
<li>Entry in <code>THIRD_PARTY.md</code> describes URL, commit, license, purpose, and path.</li>
</ul>
</li>
</ul>
<p><strong>Build &amp; ABI</strong></p>
<ul>
<li>
<p>ABIs:</p>
</li>
<li>
<p>arm64-v8a only for Whisper acceptance builds.</p>
</li>
<li>
<p>CMake:</p>
</li>
<li>
<p>Whitelist build: only the minimal ggml/whisper core files compiled.</p>
</li>
<li>Extra backends (CUDA, Metal, BLAS, etc.) <strong>excluded</strong> for now.</li>
<li>Flags: <code>-O3 -DNDEBUG -ffast-math -fno-math-errno -fno-finite-math-only -funroll-loops</code>, plus <code>-march=armv8-a</code> on arm64.</li>
</ul>
<p><strong>Runtime Behavior</strong></p>
<ul>
<li>
<p>On DEV builds:</p>
</li>
<li>
<p>Model is initialized once (warm context).</p>
</li>
<li>Recording path converts audio to 16 kHz mono buffer.</li>
<li>JNI called off the main thread (ASR executor).</li>
<li>Typical latency (stop ‚Üí text) on a decent arm64 phone: <strong>~1.6‚Äì3.5 s</strong>.</li>
<li>
<p>Timestamps:</p>
</li>
<li>
<p>For a4, timestamps are enabled (<code>no_timestamps=false</code>) and logged.</p>
</li>
<li>Truncation is engaged at 5s of audio.</li>
</ul>
<hr />
<h2 id="6-enablement-track-next-big-phase-for-whisper">6. Enablement Track (Next Big Phase for Whisper)</h2>
<p>Whisper now <strong>works</strong>. Enablement is about making it <strong>safe and controlled</strong> for real users.</p>
<h3 id="61-goals-of-enablement">6.1 Goals of Enablement</h3>
<ol>
<li>
<p><strong>Device safety gates</strong>:</p>
</li>
<li>
<p>NEON, RAM, and audio sample rate self-test.</p>
</li>
<li>
<p><strong>Feature flags</strong>:</p>
</li>
<li>
<p>File flag + remote kill-switch.</p>
</li>
<li>
<p><strong>Minimal UX integration</strong>:</p>
</li>
<li>
<p>Turn Whisper into ‚Äújust another input path‚Äù for Chief‚Äôs reply engine.</p>
</li>
<li>
<p><strong>Telemetry &amp; rollout</strong>:</p>
</li>
<li>
<p>Ensure stable, predictable behavior across devices.</p>
</li>
</ol>
<h3 id="62-planned-enablement-steps">6.2 Planned Enablement Steps</h3>
<ol>
<li>
<p><strong>Device Self-Test Screen (DEV-only)</strong>
   A simple ‚ÄúCheck my device‚Äù tool that:</p>
</li>
<li>
<p>Verifies NEON support.</p>
</li>
<li>Reads total &amp; available RAM.</li>
<li>Probes mic sample rates; chooses a stable path ‚Üí 16 kHz mono.</li>
<li>Performs a 1‚Äì2 s dummy capture + decode.</li>
<li>
<p>Only enables Whisper on that device if all checks pass.</p>
</li>
<li>
<p><strong>Runtime Gates</strong></p>
</li>
</ol>
<p>At runtime, Whisper should obey:</p>
<ul>
<li><strong>DEV flag</strong>: under <code>&lt;filesDir&gt;/whisper/USE_WHISPER_DEV</code>.</li>
<li><strong>Remote flag</strong>: configuration value from backend (kill-switch).</li>
<li><strong>Self-test results</strong>: passed vs failed.</li>
</ul>
<p>If any check fails:</p>
<ul>
<li>Whisper remains disabled.</li>
<li>
<p>Chief‚Äôs rest-of-app flows (brief, chat, calendar) remain unaffected.</p>
</li>
<li>
<p><strong>Feature Flag + Kill-Switch</strong></p>
</li>
<li>
<p>Remote config should be able to:</p>
<ul>
<li>Enable Whisper for a subset of users/devices.</li>
<li>Instantly turn it off for all or specific device models.</li>
<li>
<p>If kill-switch is ON:</p>
</li>
<li>
<p>Do not load models.</p>
</li>
<li>Do not allow mic ‚Üí Whisper path.</li>
<li>Show fallback UI (e.g., ‚Äúvoice input temporarily unavailable‚Äù).</li>
</ul>
</li>
<li>
<p><strong>UX Wiring</strong></p>
</li>
</ul>
<p>Minimal and safe:</p>
<ul>
<li>
<p>Use Whisper text as input to Chief‚Äôs existing <strong>reply pipeline</strong>:</p>
<ul>
<li>Transcribed text ‚Üí LLM context ‚Üí Supervisor ‚Üí candidate reply.</li>
<li>
<p>Keep UI changes small:</p>
</li>
<li>
<p>Text bubble or pre-filled compose field.</p>
</li>
<li>Timestamps stay internal at first (test harness), not exposed as full diarization.</li>
</ul>
</li>
<li>
<p><strong>Telemetry &amp; Stability Metrics</strong></p>
</li>
</ul>
<p>For a small internal or DEV cohort, capture:</p>
<ul>
<li>Latency per run (stop ‚Üí text).</li>
<li>CPU &amp; memory usage.</li>
<li>Segment counts &amp; truncation events.</li>
<li>Crash/ANR counts and device breakdown.</li>
</ul>
<p>Gate for broader rollout:</p>
<ul>
<li>Crash-free rate ‚â• 99.5% over a meaningful sample.</li>
<li>No ANRs linked to Whisper.</li>
<li>Latency comfortably within target (&lt; ~5 s).</li>
</ul>
<hr />
<h2 id="7-documentation-system-how-gpts-see-the-world">7. Documentation System (How GPTs See the World)</h2>
<p>We now have a <strong>three-layer documentation system</strong>:</p>
<h3 id="71-git-repos-code-proofs">7.1 Git Repos (Code + Proofs)</h3>
<ul>
<li>All <strong>code</strong> lives here (Android project, backend, etc.).</li>
<li><strong>Proof files</strong> (<code>proof/*</code>) live here <strong>if</strong> they add value (e.g., crash bundles, timing logs).</li>
<li>
<p>They are primarily for:</p>
</li>
<li>
<p>Worker GPTs</p>
</li>
<li>Human devs</li>
<li>Future debugging</li>
</ul>
<p><strong>Important update:</strong>
Proof files are <strong>optional</strong>. PM does <strong>not</strong> require them individually for every phase; high-value only (e.g., tricky crash, perf regression).</p>
<h3 id="72-shared-folder-business-account-docs-hub">7.2 Shared Folder (Business Account Docs Hub)</h3>
<ul>
<li>
<p>A small set of markdown docs:</p>
</li>
<li>
<p><code>/Chief/README.md</code> ‚Äî overall hub (current phase, guardrails, links).</p>
</li>
<li><code>/Chief/readmes/whisper.md</code> ‚Äî Whisper-specific status and pointers.</li>
<li><code>/Chief/readmes/zero-auth.md</code> ‚Äî auth/Zero-Auth guardrails.</li>
<li><code>/Chief/handover/pm.md</code> ‚Äî short PM continuity pointer.</li>
<li>
<p><code>/Chief/proof/README.md</code> ‚Äî explains proof folder usage.</p>
</li>
<li>
<p>This is the <strong>live layer</strong> GPTs read and update for current phases.</p>
</li>
<li>
<p>It should <strong>not</strong> contain code; only status, pointers, and links into the repo and Handbook.</p>
</li>
</ul>
<h3 id="73-handbook-mirror-static-published">7.3 Handbook Mirror (Static / Published)</h3>
<ul>
<li>
<p>A published mirror (GitHub Pages, etc.) that holds:</p>
</li>
<li>
<p>PM training.</p>
</li>
<li>Worker training.</li>
<li>Handover snapshots.</li>
<li>
<p>Phase summaries for each tag.</p>
</li>
<li>
<p>Updated via existing <strong>publish scripts</strong> after phases reach acceptance.</p>
</li>
<li>
<p>Serves as audit trail and high-level training reference for new GPTs.</p>
</li>
</ul>
<hr />
<h2 id="8-guardrails-you-must-enforce">8. Guardrails You Must Enforce</h2>
<p>These are non-negotiable.</p>
<ol>
<li>
<p><strong>Auth / OAuth / IDs / Gradle Namespace</strong></p>
</li>
<li>
<p>No touching <code>build.gradle</code> app IDs, OAuth client IDs, or auth logic without:</p>
<ul>
<li>seeing the file,</li>
<li>confirming it matches last good state,</li>
<li>explaining the change in one sentence.</li>
</ul>
</li>
<li>
<p><strong>Whisper Only Means Whisper</strong></p>
</li>
<li>
<p>Whisper branches should <strong>not</strong> carry auth, calendar, or unrelated UI changes.</p>
</li>
<li>
<p>If such changes are necessary, they must live in dedicated branches with their own PM scope.</p>
</li>
<li>
<p><strong>One Risky Area at a Time</strong></p>
</li>
<li>
<p>For native code changes (JNI/C++, CMake), require:</p>
<ul>
<li>a checkpoint tag before edits,</li>
<li>a clear rationale,</li>
<li>a narrow diff.</li>
</ul>
</li>
<li>
<p><strong>No Scope Creep in Enablement</strong></p>
</li>
<li>
<p>Enablement is about <strong>gating, flags, telemetry, and minimal UX</strong>.</p>
</li>
<li>
<p>Do not try to implement full diarization, speaker ID, or multiple models at this stage.</p>
</li>
<li>
<p><strong>Respect the User‚Äôs Time &amp; Hands</strong></p>
</li>
<li>
<p>User is often working with <strong>limited typing ability</strong> (broken arm) and wants:</p>
<ul>
<li>one-step instructions,</li>
<li>minimal fluff,</li>
<li>clear commands when they need to run something.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="9-open-items-to-do-for-next-pm">9. Open Items / To-Do for Next PM</h2>
<p>Short list of what you must drive next:</p>
<ol>
<li>
<p><strong>Design &amp; implement Whisper Device Self-Test</strong></p>
</li>
<li>
<p>Plan UI and behavior.</p>
</li>
<li>Implement NEON/RAM/sample-rate checks.</li>
<li>
<p>Hook into DEV flag path.</p>
</li>
<li>
<p><strong>Define and implement Kill-Switch path</strong></p>
</li>
<li>
<p>Remote flag, schema, simple behavior.</p>
</li>
<li>
<p>Ensure fallback UX is graceful.</p>
</li>
<li>
<p><strong>Connect Whisper text into the Chief Reply Pipeline</strong></p>
</li>
<li>
<p>Decide how transcribed text appears (compose box, suggestion, etc.).</p>
</li>
<li>
<p>Ensure Supervisor guardrail still runs.</p>
</li>
<li>
<p><strong>Add Lightweight Telemetry</strong></p>
</li>
<li>
<p>Capture metrics needed for enablement decisions.</p>
</li>
<li>
<p>Keep it minimal and privacy-respecting.</p>
</li>
<li>
<p><strong>Plan &amp; Run a Dogfood Pass</strong></p>
</li>
<li>
<p>Small internal cohort or DEV testing.</p>
</li>
<li>
<p>Use telemetry + feedback to decide when Whisper is safe to expose wider.</p>
</li>
<li>
<p><strong>Update Shared Folder &amp; Handbook</strong></p>
</li>
<li>
<p>Reflect this handover and future decisions in:</p>
<ul>
<li><code>/Chief/readmes/whisper.md</code></li>
<li><code>/Chief/handover/pm.md</code></li>
<li>Publish a new Handbook snapshot when the Enablement phase is accepted.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="10-how-to-resume-work-safely">10. How to Resume Work Safely</h2>
<p>When you (or another GPT) actually pick up active Whisper work:</p>
<ol>
<li>
<p>Read:</p>
</li>
<li>
<p>This handover.</p>
</li>
<li><code>/Chief/README.md</code></li>
<li><code>/Chief/readmes/whisper.md</code></li>
<li>
<p>Latest PM/Worker handovers in the Handbook mirror.</p>
</li>
<li>
<p>Confirm:</p>
</li>
<li>
<p>Which tag you‚Äôre starting from (<code>accept/whisper-a3.1-freeze-2025-11-12</code> / <code>accept/whisper-a4-freeze-2025-11-12</code>).</p>
</li>
<li>
<p>That auth is still functioning (sign-in + calendar).</p>
</li>
<li>
<p>Define:</p>
</li>
<li>
<p><strong>One</strong> small, clear phase: e.g., ‚ÄúImplement self-test only,‚Äù or ‚ÄúHook up kill-switch only.‚Äù</p>
</li>
<li>
<p>The exact guardrails and acceptance criteria for that phase.</p>
</li>
<li>
<p>Execute:</p>
</li>
<li>
<p>Direct Worker GPTs to implement code changes.</p>
</li>
<li>Keep diffs small and focused.</li>
<li>
<p>Have Worker provide a tight summary (not proof files) of what changed and how it was verified.</p>
</li>
<li>
<p>Once accepted:</p>
</li>
<li>
<p>Add a short note to Shared Folder readmes.</p>
</li>
<li>Update Handbook via existing publish scripts.</li>
</ol>
<hr />
<p>This is the full PM state for Chief Android‚Äôs Whisper v4.0 track and surrounding systems.
With this, a new PM should be able to step in, understand the context, and keep the project moving toward Enablement and then <strong>beyond Whisper</strong> into parsing, Supervisor, and multi-channel Chief.</p>
<p>Understood.
I will <strong>reproduce the full addendum exactly as before ‚Äî exhaustive, structured, product-wide ‚Äî but with <em>all LifeGraph content removed</em>.</strong></p>
<p>Here is the corrected, complete PM Handover Addendum:</p>
<hr />
<h1 id="pm-handover-addendum-full-product-layer-chief-android">‚úÖ <strong>PM Handover Addendum ‚Äî Full Product Layer (Chief Android)</strong></h1>
<h3 id="whisper-is-only-one-subsystem-this-captures-everything-else-that-matters"><em>(Whisper is only one subsystem ‚Äî this captures everything else that matters.)</em></h3>
<p><strong>Sections:</strong>
A. Chat UI &amp; Core UX
B. Parsing, Supervisor, Tone, Channels
C. App Architecture, Navigation, and System-Level Roadmap</p>
<hr />
<h1 id="a-core-ux-chat-screen-system-exhaustive"><strong>A. Core UX &amp; Chat Screen System (Exhaustive)</strong></h1>
<h2 id="a1-chat-screen-purpose"><strong>A1 ‚Äî Chat Screen: Purpose</strong></h2>
<p>The Chat Screen is the <strong>center</strong> of the app.
It is where the user:</p>
<ul>
<li>Talks to Chief</li>
<li>Types to Chief</li>
<li>Reviews context</li>
<li>Receives drafts and guidance</li>
</ul>
<p>Chief is fundamentally a <strong>conversation product</strong>, not a microphone demo or a settings tool.</p>
<p>The Chat UI is the ‚Äúhome base‚Äù of the entire experience.</p>
<hr />
<h2 id="a2-input-modes-3-paths"><strong>A2 ‚Äî Input Modes (3 paths)</strong></h2>
<h3 id="1-typing"><strong>1. Typing</strong></h3>
<ul>
<li>Normal input bar</li>
<li>Predictable, fallback-safe</li>
<li>Works even with Whisper disabled</li>
</ul>
<h3 id="2-speaking-whisper-integration"><strong>2. Speaking (Whisper integration)</strong></h3>
<ul>
<li>Long-press Pulse ‚Üí start recording</li>
<li>Tap ‚Üí stop + transcribe</li>
<li>Transcription inserted into input bar</li>
<li>User can edit or send</li>
</ul>
<h3 id="3-paste-drop-in"><strong>3. Paste / Drop-in</strong></h3>
<ul>
<li>Users paste texts, screenshots, or long passages</li>
<li>Chief parses context and drafts a reply</li>
</ul>
<hr />
<h2 id="a3-message-structure-storage"><strong>A3 ‚Äî Message Structure &amp; Storage</strong></h2>
<p>Each message has:</p>
<ul>
<li><code>id</code></li>
<li><code>timestamp</code></li>
<li><code>author: user | chief</code></li>
<li><code>text</code></li>
<li><code>metadata: { source: typed/speech/paste, tone, supervisorFlags }</code></li>
</ul>
<p>Local storage:</p>
<ul>
<li>SQLite or RoomDB</li>
<li>Only one thread in V0 (single conversation)</li>
<li>Future: multiple threads + channels</li>
</ul>
<hr />
<h2 id="a4-chat-pipeline-ux"><strong>A4 ‚Äî Chat Pipeline UX</strong></h2>
<h3 id="end-to-end-flow">End-to-end flow:</h3>
<ol>
<li>User gives input (typed/spoken/paste).</li>
<li>Chief drafts a reply.</li>
<li>Supervisor reviews the draft.</li>
<li>Tone adjustments applied.</li>
<li>Final Chief reply appears in the chat bubble.</li>
</ol>
<h3 id="ui-signals">UI signals:</h3>
<ul>
<li>Chief typing indicator</li>
<li>Supervisor warnings (friendly, not intrusive)</li>
<li>Tone adjuster</li>
<li>Re-draft option</li>
<li>‚ÄúSend as-is‚Äù vs. ‚ÄúRefine‚Äù controls</li>
</ul>
<hr />
<h2 id="a5-v0-chat-ui-must-have"><strong>A5 ‚Äî V0 Chat UI (must-have)</strong></h2>
<ul>
<li>Bubble chat</li>
<li>Input bar</li>
<li>Press-send or press-mic</li>
<li>Chief typing indicator</li>
<li>Smooth scroll</li>
<li>Minimalistic, clean, reliable</li>
</ul>
<p>This is the <strong>foundation</strong> for all future UX layers.</p>
<hr />
<h2 id="a6-v1-chat-ui-planned"><strong>A6 ‚Äî V1 Chat UI (planned)</strong></h2>
<ul>
<li>Threaded context preview</li>
<li>More polish (reactions, animation, small details)</li>
<li>‚ÄúExplain why this reply is good‚Äù</li>
<li>Reply re-write suggestions</li>
<li>Multi-channel threading (SMS/email inside Chief UI)</li>
<li>Message editing before send</li>
<li>Undo send (if supported on channel)</li>
</ul>
<hr />
<h2 id="a7-navigation-structure"><strong>A7 ‚Äî Navigation Structure</strong></h2>
<p>The app must have:</p>
<ul>
<li><strong>Home:</strong> Chat Screen</li>
<li><strong>Settings:</strong> Quiet Hours, data, mic permissions</li>
<li><strong>Calendar:</strong> built-in preview</li>
<li><strong>Help:</strong> contact, FAQ</li>
<li><strong>Developer Tools (hidden):</strong> Whisper DEV flag, logs</li>
</ul>
<p>This keeps the app simple but scalable.</p>
<hr />
<h1 id="b-parsing-supervisor-tone-channels-full-intelligence-layer"><strong>B. Parsing, Supervisor, Tone, Channels ‚Äî Full Intelligence Layer</strong></h1>
<p>Chief is not just transcription.
Chief‚Äôs <em>intelligence</em> is a pipeline:</p>
<hr />
<h2 id="b1-parsing-layer-context-understanding"><strong>B1 ‚Äî Parsing Layer (context understanding)</strong></h2>
<p>When the user provides input (typed or transcribed), parsing runs:</p>
<ul>
<li>Intent detection (‚ÄúShould I reply?‚Äù ‚ÄúQuestion?‚Äù ‚ÄúArgument?‚Äù)</li>
<li>Emotional tone detection</li>
<li>Urgency</li>
<li>Conversation role detection (‚ÄúWho said what?‚Äù)</li>
<li>Relationship context (if known through conversation itself ‚Äî not LifeGraph)</li>
<li>Thread consistency</li>
<li>
<p>Message type:</p>
</li>
<li>
<p>logistics</p>
</li>
<li>emotional</li>
<li>boundary</li>
<li>negotiation</li>
<li>business</li>
<li>casual</li>
<li>romantic</li>
<li>crisis</li>
</ul>
<p>Parsing outputs a <strong>structured interpretation</strong> of the message for Supervisor + LLM drafting.</p>
<hr />
<h2 id="b2-supervisor-layer-safety-clarity"><strong>B2 ‚Äî Supervisor Layer (safety + clarity)</strong></h2>
<p>Supervisor is the ‚Äúguardian‚Äù that sits between the draft and the final message.</p>
<p>Supervisor checks for:</p>
<ul>
<li>Over-sharing</li>
<li>Emotional reactivity</li>
<li>Petty or defensive language</li>
<li>Contradictions</li>
<li>Social misreads</li>
<li>Escalations</li>
<li>Tone mismatch</li>
<li>Logical gaps</li>
<li>Bad assumptions</li>
</ul>
<p>It can:</p>
<ul>
<li>Edit the draft</li>
<li>Rewrite sections</li>
<li>Flag issues (‚ÄúThis may escalate tension ‚Äî consider softening‚Ä¶‚Äù)</li>
<li>Suggest alternate tones</li>
</ul>
<p>Supervisor is what makes Chief <strong>trustworthy</strong>.</p>
<hr />
<h2 id="b3-tone-engine"><strong>B3 ‚Äî Tone Engine</strong></h2>
<p>Tone presets shape the message after Supervisor:</p>
<h3 id="presets">Presets:</h3>
<ul>
<li>Calm</li>
<li>Confident</li>
<li>Warm</li>
<li>Neutral</li>
<li>Professional</li>
<li>Polite assertive</li>
<li>Soft supportive</li>
<li>Boundaries / firm</li>
</ul>
<p>Tone adjustment is a <strong>must</strong> for a production Chief.</p>
<hr />
<h2 id="b4-reply-engine-integration"><strong>B4 ‚Äî Reply Engine Integration</strong></h2>
<p>Pipeline:</p>
<ol>
<li>User input ‚Üí parsed</li>
<li>Draft produced (LLM)</li>
<li>Supervisor review</li>
<li>Tone chosen</li>
<li>Final reply</li>
<li>Displayed in chat</li>
</ol>
<p>The Chat UI must visually support:</p>
<ul>
<li>Draft placeholder</li>
<li>‚ÄúChief is thinking‚Ä¶‚Äù</li>
<li>Optional ‚ÄúTry another tone‚Äù</li>
<li>Final bubble</li>
</ul>
<hr />
<h2 id="b5-channel-adapters-future"><strong>B5 ‚Äî Channel Adapters (future)</strong></h2>
<p>Chief eventually supports multiple channels:</p>
<h3 id="first-wave">First wave:</h3>
<ul>
<li>SMS</li>
<li>Email</li>
</ul>
<h3 id="future-wave">Future wave:</h3>
<ul>
<li>Messenger</li>
<li>WhatsApp</li>
<li>iMessage (likely only partial support)</li>
</ul>
<h3 id="channel-adapter-responsibilities">Channel adapter responsibilities:</h3>
<ul>
<li>Reading full threads</li>
<li>Parsing threads</li>
<li>Mapping sender/receiver</li>
<li>Drafting replies</li>
<li>Sending replies</li>
<li>Error handling</li>
<li>Rate-limit handling</li>
<li>Channel-specific formatting</li>
</ul>
<p>Right now ‚Üí <strong>SMS + Email</strong> are the practical focus.</p>
<hr />
<h1 id="c-architecture-navigation-system-roadmap-non-whisper"><strong>C. Architecture, Navigation, System Roadmap (Non-Whisper)</strong></h1>
<p>This section captures everything <em>outside</em> Whisper, Chat UI, and Reasoning.</p>
<hr />
<h2 id="c1-app-architecture-high-level"><strong>C1 ‚Äî App Architecture (High-Level)</strong></h2>
<h3 id="layers">Layers:</h3>
<ul>
<li>UI layer (Compose screens)</li>
<li>Interaction layer (Pulse, mic, typing, paste)</li>
<li>Conversation pipeline (draft ‚Üí supervisor ‚Üí tone ‚Üí UI)</li>
<li>Channel adapters (SMS/email)</li>
<li>Storage (RoomDB)</li>
<li>Network layer (backend REST APIs)</li>
<li>Permissions &amp; device services (mic, notifications)</li>
</ul>
<h3 id="chiefs-app-is-organized-around">Chief‚Äôs app is organized around:</h3>
<ul>
<li>A <strong>single conversation</strong> in V0</li>
<li>Gradual expansion to multi-channel threading in V1</li>
</ul>
<hr />
<h2 id="c2-quiet-hours-notification-logic"><strong>C2 ‚Äî Quiet Hours &amp; Notification Logic</strong></h2>
<p>Quiet Hours:</p>
<ul>
<li>Blocks active Chief responses</li>
<li>Softens notifications</li>
<li>Still lets urgent cues through (future)</li>
<li>Integrated into Chat UI</li>
<li>Should not break Whisper or mic flow</li>
</ul>
<p>Notification UX:</p>
<ul>
<li>Chief reply notifications</li>
<li>Sent message confirmations</li>
<li>Channel adapter notifications</li>
</ul>
<hr />
<h2 id="c3-brief-summary-mode"><strong>C3 ‚Äî Brief / Summary Mode</strong></h2>
<p>Brief is a reading mode:</p>
<ul>
<li>Summaries calendar events</li>
<li>Summaries messages</li>
<li>Summaries logistics tasks</li>
</ul>
<p>Pulse button also triggers brief behavior when Whisper is OFF.</p>
<p>Brief must not break when Whisper is enabled.</p>
<hr />
<h2 id="c4-error-handling-ux"><strong>C4 ‚Äî Error Handling UX</strong></h2>
<p>The app must gracefully handle:</p>
<ul>
<li>Mic denied</li>
<li>Whisper disabled (flag, kill-switch, device self-test fail)</li>
<li>Network failures</li>
<li>OAuth token errors</li>
<li>Offline mode</li>
<li>Channel send failures</li>
</ul>
<p>No crashes.
No mysterious behavior.
Always a clear message.</p>
<hr />
<h2 id="c5-app-roadmap-post-whisper"><strong>C5 ‚Äî App Roadmap (Post-Whisper)</strong></h2>
<p>After Whisper Enablement:</p>
<h3 id="phase-51-parsing-expansion"><strong>Phase 5.1 ‚Äî Parsing expansion</strong></h3>
<p>Better thread parsing from long texts/emails.</p>
<h3 id="phase-52-supervisor-improvements"><strong>Phase 5.2 ‚Äî Supervisor improvements</strong></h3>
<p>More robust social/emotional safety.</p>
<h3 id="phase-53-tone-engine-polish"><strong>Phase 5.3 ‚Äî Tone engine polish</strong></h3>
<p>Cleaner slider, more presets.</p>
<h3 id="phase-54-multi-channel"><strong>Phase 5.4 ‚Äî Multi-channel</strong></h3>
<p>SMS and email full integration in-app.</p>
<h3 id="phase-55-chat-ui-v1"><strong>Phase 5.5 ‚Äî Chat UI V1</strong></h3>
<p>More polished UX, better message flow, better controls.</p>
<p>Whisper becomes <strong>infrastructure</strong>; the real product is the conversation intelligence.</p>
<hr />
<h1 id="d-guardrails-you-must-enforce-global"><strong>D. Guardrails You Must Enforce (Global)</strong></h1>
<p>These are permanent PM rules:</p>
<h3 id="d1-authoauth"><strong>D1 ‚Äî Auth/OAuth</strong></h3>
<p>Never modify:</p>
<ul>
<li>OAuth code</li>
<li>Client IDs</li>
<li>App IDs</li>
<li>
<p>Gradle namespaces
  Without:</p>
</li>
<li>
<p>Seeing the file</p>
</li>
<li>Confirming it's the last known good version</li>
<li>Explaining the change in <em>1 sentence</em></li>
<li>Receiving explicit approval</li>
</ul>
<h3 id="d2-whisper-must-stay-contained"><strong>D2 ‚Äî Whisper Must Stay Contained</strong></h3>
<p>Whisper work must <em>never</em> modify:</p>
<ul>
<li>Non-mic UI</li>
<li>Auth flows</li>
<li>Channel logic</li>
<li>App IDs</li>
<li>Navigation core</li>
</ul>
<h3 id="d3-one-risky-edit-at-a-time"><strong>D3 ‚Äî One risky edit at a time</strong></h3>
<p>Native code, CMake, or Pulse refactors get:</p>
<ul>
<li>A checkpoint tag</li>
<li>A single-purpose PR</li>
<li>A clear diff</li>
</ul>
<h3 id="d4-the-shared-folder-handbook-rules"><strong>D4 ‚Äî The Shared Folder + Handbook Rules</strong></h3>
<ul>
<li>Shared Folder = live documentation</li>
<li>Handbook Mirror = published phase snapshots</li>
<li>Proof files = <strong>optional</strong> (only if needed)</li>
</ul>
<hr />
<h1 id="e-summary-what-this-addendum-fixes"><strong>E. Summary ‚Äî What This Addendum Fixes</strong></h1>
<p>The original Whisper-focused handover was missing:</p>
<ul>
<li>Chat UI architecture</li>
<li>Full UX behavior</li>
<li>Parsing system</li>
<li>Supervisor logic</li>
<li>Tone engine</li>
<li>Channel adapters</li>
<li>Overall navigation</li>
<li>Post-Whisper roadmap</li>
<li>Error handling UX</li>
<li>Brief / Summary behavior</li>
<li>State architecture across the app</li>
</ul>
<p>This addendum now completes that picture.</p>
<hr />
<p>üß≠ **Handover: Whisper JNI Build ‚Äî feat/v4.0a3-whisper-rebuild **</p>
<p><strong>Date:</strong> 2025-11-11
<strong>Author:</strong> Worker GPT
<strong>Environment:</strong> <code>~/AndroidStudioProjects/Chief</code> on Windows (Git Bash / MINGW64)
<strong>Branch:</strong> <code>feat/v4.0a3-whisper-rebuild</code> (off <code>safety/post-rescue-2025-11-10</code>)
<strong>Goal:</strong> Achieve a clean, working JNI + NDK build for Whisper (whisper.cpp) integrated into Chief. Remove linker chaos, align ggml backend logic, and confirm <code>.so</code> output for both <code>arm64-v8a</code> and <code>x86_64</code>.</p>
<hr />
<h3 id="summary-of-work-done">‚úÖ <strong>Summary of Work Done</strong></h3>
<p><strong>Root Issue:</strong>
Initial builds failed with unresolved <code>ggml_backend_*</code> and <code>whisper_*</code> symbols during link time. This pointed to broken linkage between Whisper‚Äôs core (<code>libwhisper_core.a</code>) and JNI bridge (<code>libwhisper_jni.so</code>).</p>
<p><strong>Investigation &amp; Verification:</strong></p>
<ul>
<li>Inspected <code>ggml/src</code> and <code>include</code> for symbol definitions ‚Äî confirmed they exist but weren‚Äôt linked in.</li>
<li>Verified CMakeLists under <code>ggml/src</code> (very large, backend-heavy) ‚Äî used to confirm backend registration macros and targets are valid.</li>
<li>Validated directory completeness with <code>ls -la</code> (ggml tree was fully populated).</li>
<li>Checked for <code>def ggml_backend_</code> symbols using grep ‚Äî verified headers had typedefs, but linker symbols missing ‚Üí link order issue, not source absence.</li>
</ul>
<p><strong>CMake Adjustments:</strong></p>
<ul>
<li>Confirmed all <code>ggml</code> sources are built into <code>whisper_core.a</code>.</li>
<li>Ensured JNI explicitly links against that static library (<code>whisper_core</code>).</li>
<li>Cleaned and rebuilt CMake environment with:</li>
</ul>
<p><code>bash
  ./gradlew clean :app:buildCMakeDebug --no-daemon --info</code></p>
<p>‚Üí Fully rebuilt <code>.cxx/Debug</code> directory for fresh build generation.</p>
<p><strong>Verification Build:</strong></p>
<ul>
<li>
<p>Rebuild succeeded on both ABIs:</p>
</li>
<li>
<p>‚úÖ <code>arm64-v8a</code></p>
</li>
<li>‚úÖ <code>x86_64</code></li>
<li><code>.so</code> successfully linked with <code>whisper_core.a</code></li>
<li>Only one benign warning:</li>
</ul>
<p><code>'whisper_init_from_file' is deprecated: use whisper_init_from_file_with_params instead</code></p>
<p>‚Üí Safe to ignore for now (backward-compatible; will migrate later).</p>
<p><strong>No linker errors remain. Build completed successfully with:</strong></p>
<pre><code>BUILD SUCCESSFUL in 57s
</code></pre>
<hr />
<h3 id="current-status">üß© <strong>Current Status</strong></h3>
<ul>
<li>‚úÖ Native build successful on both ABIs.</li>
<li>‚úÖ No missing or undefined symbols.</li>
<li>‚ö†Ô∏è One deprecated function warning (non-blocking).</li>
<li>‚öôÔ∏è Whisper JNI layer (<code>libwhisper_jni.so</code>) produced cleanly.</li>
<li>üß± Verified NDK, CMake, and Gradle are synchronized and stable.</li>
</ul>
<hr />
<h3 id="environment-verification">üß∞ <strong>Environment &amp; Verification</strong></h3>
<ul>
<li><strong>NDK:</strong> 27.0.12077973</li>
<li><strong>CMake:</strong> 3.22.1</li>
<li><strong>Toolchain:</strong> clang++ (Android LLVM)</li>
<li><strong>ABIs:</strong> arm64-v8a, x86_64</li>
<li><strong>Gradle:</strong> 8.13</li>
</ul>
<p>Verification artifacts:</p>
<pre><code class="language-bash">ls app/build/intermediates/cxx/Debug/*/obj/*/libwhisper_jni.so
</code></pre>
<p>Both architectures output confirmed.</p>
<hr />
<h3 id="open-items-next-steps">‚ö†Ô∏è <strong>Open Items / Next Steps</strong></h3>
<ol>
<li><strong>Deprecation Update (optional next phase)</strong>
   Replace:</li>
</ol>
<p><code>cpp
   whisper_init_from_file(path);</code></p>
<p>with:</p>
<p><code>cpp
   whisper_context_params params = whisper_context_default_params();
   g_ctx = whisper_init_from_file_with_params(path, params);</code></p>
<p>‚Üí Ensures future-proof compatibility with new whisper.cpp API.</p>
<ol>
<li>
<p><strong>Runtime JNI Validation</strong></p>
</li>
<li>
<p>Confirm successful model load:</p>
<p><code>I/WhisperEngine: modelLoaded=true path=/data/user/0/app.chief.app/files/whisper/ggml-tiny.en-q5_1.bin</code>
   * Run short PCM sample to confirm text output.</p>
</li>
<li>
<p><strong>Post-Validation Tag</strong></p>
</li>
<li>
<p><code>v4.0a3-whisper-rebuild-accepted-2025-11-11</code></p>
</li>
</ol>
<hr />
<h3 id="key-files">üß± <strong>Key Files</strong></h3>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>app/src/main/cpp/CMakeLists.txt</code></td>
<td>Final native build orchestration</td>
</tr>
<tr>
<td><code>app/src/main/cpp/whisper_jni.cpp</code></td>
<td>JNI bridge to whisper.cpp</td>
</tr>
<tr>
<td><code>app/src/main/cpp/third_party/whisper.cpp/</code></td>
<td>Vendored Whisper + ggml source tree</td>
</tr>
<tr>
<td><code>app/src/main/java/app/chief/app/speech/WhisperEngine.kt</code></td>
<td>Kotlin interface layer</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="meta">ü™∂ <strong>Meta</strong></h3>
<ul>
<li>Worker adhered to guardrails (single-step, no OAuth edits, no Gradle tampering).</li>
<li>Branch state clean and validated.</li>
<li>Build log used for proof receipts.</li>
<li>Verified <code>.so</code> existence and no fatal warnings.</li>
</ul>
<hr />
<h3 id="tags-branching">üîñ <strong>Tags &amp; Branching</strong></h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Base safety branch</td>
<td><code>safety/post-rescue-2025-11-10</code></td>
</tr>
<tr>
<td>Active feature branch</td>
<td><code>feat/v4.0a3-whisper-rebuild</code></td>
</tr>
<tr>
<td>Next checkpoint tag</td>
<td><code>v4.0a3-whisper-rebuild-accepted-2025-11-11</code></td>
</tr>
</tbody>
</table>
<hr />
<p><strong>Outcome:</strong>
‚úÖ Whisper JNI and NDK integration are now stable and fully buildable.
No linker errors remain.
Next step: runtime test and tag release.</p>
<hr />
<p>üß≠ Handover: Whisper Rebuild ‚Äî feat/v4.0a3-whisper-rebuild</p>
<p>Date: 2025-11-11
Author: Worker GPT
Environment: ~/AndroidStudioProjects/Chief on Windows (Git Bash / MINGW64)
Branch: feat/v4.0a3-whisper-rebuild (off safety/post-rescue-2025-11-10)
Goal: Restore and rebuild offline Whisper ASR integration via whisper.cpp (NDK-based), vendor the latest sources, fix all linker/include issues, and reach successful .so build for libwhisper_jni.so.</p>
<p>‚úÖ Summary of Work Done</p>
<p>Vendored whisper.cpp source tree</p>
<p>Added under: app/src/main/cpp/third_party/whisper.cpp</p>
<p>Verified upstream commit &amp; licensing (record provenance per PM rule).</p>
<p>Shim Compatibility Layer Attempt (ggml-compat.c)</p>
<p>Added ggml-compat.c to re-expose legacy symbols:</p>
<p>ggml_backend_dev_count, ggml_backend_dev_get, etc.</p>
<p>Corrected recursion bug (ggml_backend_by_type ‚Üí ggml_backend_dev_by_type).</p>
<p>Registered file in CMakeLists.txt whitelist.</p>
<p>Ultimately removed the shim after new backend headers caused signature conflicts.</p>
<p>ggml-backend.h now requires ggml_backend_reg_t args; incompatible with legacy call pattern.</p>
<p>Resolved by restoring pristine upstream behavior.</p>
<p>CMake Rebuild &amp; Cleanup</p>
<p>Confirmed failure chain: linker errors ‚Üí missing symbols ‚Üí ggml-compat.c not compiled ‚Üí then removed.</p>
<p>Reset CMakeLists.txt via:</p>
<p>git checkout -- app/src/main/cpp/CMakeLists.txt
rm -f app/src/main/cpp/third_party/whisper.cpp/ggml/src/ggml-compat.c</p>
<p>Verified revert success and fresh CMake regeneration.</p>
<p>Include Path Fixes</p>
<p>whisper_jni.cpp originally used:</p>
<h1 id="include-includewhisperh">include "include/whisper.h"</h1>
<p>‚Üí changed to:</p>
<h1 id="include-whisperh">include "whisper.h"</h1>
<p>Added explicit include directories for JNI target:</p>
<p>target_include_directories(whisper_jni PRIVATE
  ${CMAKE_CURRENT_SOURCE_DIR}/third_party/whisper.cpp/include
  ${CMAKE_CURRENT_SOURCE_DIR}/third_party/whisper.cpp/ggml/include
  ${CMAKE_CURRENT_SOURCE_DIR}/third_party/whisper.cpp/ggml/src
)</p>
<p>Linker Failure (undefined Whisper symbols)</p>
<p>Next failure: unresolved symbols whisper_free, whisper_init_from_file, etc.</p>
<p>Root cause: JNI wasn‚Äôt linked against the static core lib.</p>
<p>Final Link Fix</p>
<p>Added conditional block to CMake:</p>
<p>if (TARGET whisper_core)
  target_link_libraries(whisper_jni PRIVATE whisper_core)
else()
  add_library(whisper_core STATIC ${WHISPER_WHITELIST})
  target_include_directories(whisper_core PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/third_party/whisper.cpp/include
    ${CMAKE_CURRENT_SOURCE_DIR}/third_party/whisper.cpp/ggml/include
    ${CMAKE_CURRENT_SOURCE_DIR}/third_party/whisper.cpp/ggml/src
  )
  target_link_libraries(whisper_core PUBLIC atomic m)
  target_link_libraries(whisper_jni PRIVATE whisper_core)
endif()</p>
<p>This ensures JNI links directly to the Whisper core static library.</p>
<p>üß© Current Status</p>
<p>Build succeeds up to linking phase; final fix expected to resolve whisper_* unresolved symbols.</p>
<p>No more include or path errors.</p>
<p>NDK, CMake, Gradle, and all sources validated as synchronized.</p>
<p>üß∞ Environment &amp; Verification</p>
<p>NDK: 27.0.12077973</p>
<p>CMake: 3.22.1</p>
<p>ABI: arm64-v8a</p>
<p>Verified commands:</p>
<p>./gradlew :app:assembleDebug --no-daemon --info
llvm-nm -A app/.cxx/Debug/.../libwhisper_core.a | grep whisper_</p>
<p>Confirmed header paths and static lib presence in .a.</p>
<p>‚ö†Ô∏è Open Items / Next Steps</p>
<p>Re-run build and confirm final link success (expect no undefined whisper_* symbols).</p>
<p>Once confirmed:</p>
<p>Tag commit as v4.0a3-whisper-rebuild-accepted-YYYY-MM-DD.</p>
<p>Update THIRD_PARTY.md with upstream commit hash &amp; license.</p>
<p>Test JNI runtime:</p>
<p>Verify WhisperEngine.nativeLoadModel() loads ggml-tiny.en-q5_1.bin without crash.</p>
<p>Confirm WhisperEngine.nativeTranscribe() returns text output from short PCM clip.</p>
<p>If runtime OK ‚Üí mark feature as integrated in v4.0a3 milestone and close directive.</p>
<p>üß± Key Files</p>
<p>app/src/main/cpp/CMakeLists.txt ‚Äî final patched include/link logic.</p>
<p>app/src/main/cpp/whisper_jni.cpp ‚Äî JNI bridge.</p>
<p>app/src/main/cpp/third_party/whisper.cpp/ ‚Äî vendored engine source.</p>
<p>app/src/main/java/app/chief/app/speech/WhisperEngine.kt ‚Äî Kotlin wrapper.</p>
<p>üîñ Tags &amp; Branching
Type    Name
Base safety branch  safety/post-rescue-2025-11-10
Active feature branch   feat/v4.0a3-whisper-rebuild
Next checkpoint (after success) v4.0a3-whisper-rebuild-accepted-2025-11-11
üßæ Verification Notes</p>
<p>Run smoke test after linking succeeds:</p>
<p>adb logcat -c
adb logcat -v time WhisperEngine:I *:S</p>
<p>Trigger model load and confirm log output:</p>
<p>I/WhisperEngine: modelLoaded=true path=/data/user/0/app.chief.app/files/whisper/ggml-tiny.en-q5_1.bin</p>
<p>ü™∂ Meta</p>
<p>Worker adhered to guardrails (no multi-step, no OAuth edits, full CMake isolation).</p>
<p>Backups already protected via safety branch.</p>
<p>Verified environment paths and gradlew integrity.</p>
<hr />
<p>Handover ‚Äî Whisper Rebuild (a3)</p>
<p>Branch: feat/v4.0a3-whisper-rebuild
Date: 2025-11-11 (America/Vancouver)
Goal: Get JNI/NDK build green with minimal, Android-only guards. No behavior changes.</p>
<p>What we did / decisions</p>
<p>Kept build scope minimal: Android-only, whitelist changes in app/src/main/cpp/CMakeLists.txt.</p>
<p>Unblocked ggml version symbol: Build died on missing GGML_COMMIT. We chose a temporary compile-time define to get past it, rather than editing third-party sources or generating headers. This keeps the diff tiny and reversible.</p>
<p>Current build status</p>
<p>Before fix: Ninja stopped with GGML_COMMIT not defined while compiling ggml sources.</p>
<p>After fix: Macro is now defined for target whisper_core. Next action is to re-build to see if anything else blocks.</p>
<p>Exact hunks (with filenames)</p>
<p>File: app/src/main/cpp/CMakeLists.txt
Rationale: Provide a local definition so ggml can compile without touching vendor files.</p>
<h1 id="temp-define-commit-string-to-satisfy-ggml-build-android-only">TEMP: define commit string to satisfy ggml build (Android-only)</h1>
<p>target_compile_definitions(whisper_core PRIVATE GGML_COMMIT="unknown")</p>
<p>Inserted once, after add_library(whisper_core STATIC ‚Ä¶) and its options/includes. Scoped to whisper_core only.</p>
<p>No other behavior-, API-, or runtime-affecting edits were made.</p>
<p>Receipts (proof artifacts)</p>
<p>Error trace captured (user paste): ninja failure with GGML_COMMIT undefined during ggml compile under:</p>
<p>C:\Users\User\AndroidStudioProjects\Chief\app.cxx\Debug\5k6b526g\arm64-v8a
cmake 3.22.1 ‚Ä¢ ninja ‚Ä¢ ABI: arm64-v8a</p>
<p>Repo grep confirming target names and where we injected the fix:</p>
<p>app/src/main/cpp/CMakeLists.txt:44 add_library(whisper_core STATIC ‚Ä¶)
app/src/main/cpp/CMakeLists.txt:61 target_link_libraries(whisper_jni PRIVATE whisper_core ‚Ä¶)</p>
<p>Command used to append the fix (already run by you):</p>
<p>printf '\n# temp fix... \n' &gt;&gt; app/src/main/cpp/CMakeLists.txt</p>
<p>Open items / risks</p>
<p>TEMP define: GGML_COMMIT="unknown" is a stop-gap. Upstream usually generates a commit header; we‚Äôre bypassing that. Risk is only cosmetic (version string) unless ggml expects special formatting elsewhere.</p>
<p>Scope check: If any ggml/whisper sources are compiled under a different target, we may need the same definition there. Right now it‚Äôs scoped to whisper_core which is what links them.</p>
<p>Next blockers: After this, typical next errors are missing NEON flags, pthreads, or incorrect C/C++ standards on some NDKs. Our CMake already shows Threads::Threads and -O3 -DNDEBUG ‚Ä¶; we‚Äôll adjust only if the build asks for it.</p>
<p>Next step (single)</p>
<p>Run a debug build to verify the unblock and surface the next concrete error (if any):</p>
<p>./gradlew :app:assembleDebug</p>
<p>If build still fails (one-liners, in order)</p>
<p>Show the exact failing line(s) (one screen) so we can add the minimal flag/include.</p>
<p>If GGML_COMMIT pops again under another target, mirror the same target_compile_definitions on that target only.</p>
<p>If we hit missing pthreads on some toolchains, we‚Äôll link -pthread via target_link_libraries(whisper_core PRIVATE Threads::Threads) (it‚Äôs already present per grep; we‚Äôll confirm on error).</p>
<p>Rollback</p>
<p>Revert the temp define by deleting the single target_compile_definitions(whisper_core ‚Ä¶) line. No vendor files touched, so rollback is trivial.</p>
<p>Direction (why this path)</p>
<p>Keep vendor tree pristine.</p>
<p>Keep surface area tiny (one CMake line).</p>
<p>Get a green build first, then replace the temp define with a proper generated header later if we care about version strings.</p>
<hr />
<h1 id="chief-project-manager-handover">Chief ‚Äî Project Manager Handover</h1>
<p>This is the definitive, single-source handover for the next PM GPT. If this were the only artifact left, you could reopen the build and run it like I do‚Äîno gaps, no guesswork. It marks <strong>CURRENT</strong> vs <strong>LEGACY</strong> everywhere so nothing old leaks forward.</p>
<hr />
<h2 id="1-project-overview">1) Project Overview</h2>
<p><strong>What this is</strong>
Chief is a calm, voice-first personal assistant that reads your real Google Calendar, speaks natural briefs, and (next) lets you talk casually so Chief drafts ‚Üí confirms ‚Üí writes events. It values truth over flash, privacy over convenience, and zero silent changes.</p>
<p><strong>Mission &amp; personality</strong></p>
<ul>
<li>Calm, precise, respectful; never frantic.</li>
<li>Always truthful about what it did vs what you asked.</li>
<li>Ask before writing; confirm outcomes; no surprises.</li>
<li>Respect <strong>Silent Mode</strong> + <strong>Quiet Hours</strong> (global audio gate).</li>
<li>Celebrate small wins with ‚ÄúBoom.‚Äù and move on.</li>
</ul>
<p><strong>CURRENT guiding principles</strong></p>
<ul>
<li><strong>Confirm ‚Üí then write.</strong> No silent writes‚Äîever.</li>
<li><strong>Receipts not videos.</strong> PM decisions rely on concise text receipts.</li>
<li><strong>Tiny, reversible diffs.</strong></li>
<li><strong>Auth freeze by default.</strong> Touch OAuth only with file-in-hand review + one-line change summary.</li>
<li><strong>America/Vancouver TZ</strong> correctness across device/server.</li>
<li><strong>Phase gates.</strong> Don‚Äôt mix scopes.</li>
</ul>
<p><strong>LEGACY (replaced)</strong></p>
<ul>
<li>Video-based acceptance as required proof ‚Üí <strong>replaced</strong> by text receipts.</li>
<li>System SpeechRecognizer as ‚Äúthe solution‚Äù ‚Üí <strong>reduced</strong> to DEV fallback; Whisper on-device is the target.</li>
<li>‚ÄúQuick auth tweaks‚Äù mid-phase ‚Üí <strong>forbidden</strong> without explicit PM + file review.</li>
</ul>
<hr />
<h2 id="2-state-of-development">2) State of Development</h2>
<p><strong>Shipped &amp; accepted</strong></p>
<ul>
<li>
<p><strong>v3.9 ‚Äî Onboarding Greeting (first-run, gated)</strong></p>
</li>
<li>
<p>Plays once if not Silent/Quiet; otherwise text only.</p>
</li>
<li>DEV-only ‚ÄúReset onboarding‚Äù exists; no auth/package changes.</li>
<li>
<p>Tags (Android/Backend):</p>
<ul>
<li><code>v3.9-onboarding-polish-accepted-2025-11-09</code></li>
<li><code>v3.9-profile-updatedAt-accepted-2025-11-09</code></li>
<li><strong>v4.0a.0 ‚Äî Mic &amp; Transcribe (system ASR prototype)</strong></li>
</ul>
</li>
<li>
<p>Mic pipeline with simple VAD; in-memory preview; logs <code>ASR{...}</code>; no writes.</p>
</li>
<li>PR opened into the 4.0 integration base.</li>
<li>
<p><strong>v4.0a.1 ‚Äî Whisper NDK skeleton (JNI only)</strong></p>
</li>
<li>
<p>JNI loads, version logs, <code>.so</code> ships; no behavior change.</p>
</li>
<li>Tag after merge: <code>v4.0a1-whisper-ndk-skel-accepted-2025-11-10</code>.</li>
</ul>
<p><strong>In progress / queued</strong></p>
<ul>
<li>
<p><strong>v4.0a.2 ‚Äî Whisper core (offline transcript, DEV flag)</strong> ‚Üê <strong>NEXT ACTIVE</strong></p>
</li>
<li>
<p>Vendor <code>whisper.cpp</code>, <code>nativeLoadModel</code>, <code>nativeTranscribe</code>, DEV model path, flag-controlled.</p>
</li>
</ul>
<p><strong>Upcoming</strong></p>
<ul>
<li><strong>v4.0b ‚Äî Parse ‚Üí EventDraft (rules-first; LLM optional behind DEV flag).</strong></li>
<li><strong>v4.0c ‚Äî Calendar Write</strong> (requires OAuth file review; confirm before commit).</li>
<li><strong>v4.1 ‚Äî Replies (template-first NLG + TTS)</strong>.</li>
</ul>
<p><strong>Known working today</strong></p>
<ul>
<li>Sign-in flows; briefs (Pulse) play; Silent/Quiet chips; onboarding once-only; system mic prototype.</li>
</ul>
<p><strong>Open nits (non-blocking, P2)</strong></p>
<ul>
<li>Brief screen <strong>Chat button</strong> entry missing (UI parity).</li>
<li>Onboarding greet after DEV reset had one flaky report (re-verify gating + persistence).</li>
</ul>
<hr />
<h2 id="3-workflow-collaboration-protocol">3) Workflow &amp; Collaboration Protocol</h2>
<p><strong>Role lanes</strong></p>
<ul>
<li><strong>PM (you):</strong> Scope guard, phase gates, directives, acceptance, tagging. Push back firmly.</li>
<li><strong>Worker GPT:</strong> Executes one directive at a time; posts receipts; no speculative edits.</li>
<li><strong>User (Ryley):</strong> Product owner; time-boxed reviews; explicit approvals for hot areas (OAuth/Gradle).</li>
</ul>
<p><strong>One-step rhythm</strong></p>
<ul>
<li>PM issues <strong>one</strong> directive ‚Üí Worker executes ‚Üí attaches <strong>text receipts</strong> ‚Üí PM accepts or bounces with a tiny fix. Repeat.</li>
</ul>
<p><strong>Proof/acceptance (receipts standard)</strong></p>
<ul>
<li>ADB/console lines that show <strong>one clean run</strong>: precondition ‚Üí action ‚Üí result.</li>
<li>Branch/base explicitly stated; scope + risk note in PR body.</li>
<li>No videos required for PM decisions (optional for the team).</li>
</ul>
<p><strong>Safety before speed</strong></p>
<ul>
<li>Checkpoint tags before high-risk edits (NDK/Gradle).</li>
<li>No OAuth touches without file-in-hand diff + one-line change description.</li>
<li>Small PRs; never bundle.</li>
</ul>
<p><strong>Truth over momentum</strong></p>
<ul>
<li>If something‚Äôs unknown, say it; propose how to verify.</li>
<li>Don‚Äôt guess. Don‚Äôt hide instability. We fix root causes.</li>
</ul>
<hr />
<h2 id="4-communication-style-tone">4) Communication Style &amp; Tone</h2>
<ul>
<li>Direct, warm, grounded. No fluff.</li>
<li>Push back when scope leaks or risk rises; explain why in one sentence.</li>
<li>Praise is brief (‚ÄúBoom.‚Äù) to mark progress; then next step.</li>
<li>Ask at most <strong>one</strong> clarifying question when needed.</li>
</ul>
<hr />
<h2 id="5-architecture-system-overview">5) Architecture &amp; System Overview</h2>
<p><strong>High-level</strong></p>
<ul>
<li>
<p><strong>Android app (Compose/Media3)</strong></p>
</li>
<li>
<p>Core screens: Home/Brief, Onboarding modal, Chat (entry pending).</p>
</li>
<li>Global audio gate: <strong>Silent Mode OR Quiet Hours</strong> blocks speech.</li>
<li>Speech: ExoPlayer for TTS playback; mic pipeline for ASR.</li>
<li>Upcoming: <code>WhisperEngine</code> JNI bridge.</li>
<li>
<p><strong>Backend (Node/Express)</strong></p>
</li>
<li>
<p>Endpoints in play:</p>
<ul>
<li><code>/profile</code> GET/POST (partial upsert; returns <code>updatedAt</code>).</li>
<li><code>/onboarding/greet</code> ‚Üí persona/SSML/text.</li>
<li>TTS internal route (ElevenLabs primary; Google fallback).</li>
<li>Planned: <code>/calendar/create</code> (after OAuth file review).</li>
<li><strong>Identity / headers</strong></li>
</ul>
</li>
<li>
<p>Device UUID via <code>x-user-id</code>.</p>
</li>
<li><strong>Auth is frozen</strong> unless we review the exact files.</li>
</ul>
<p><strong>Data flow (current &amp; planned)</strong></p>
<ul>
<li><strong>Briefs</strong>: app ‚Üí backend ‚Üí TTS ‚Üí playback; respects gate.</li>
<li><strong>Mic</strong>: device mic ‚Üí ASR (system or Whisper) ‚Üí transcript preview.</li>
<li><strong>Intent (planned)</strong>: transcript ‚Üí rules parser ‚Üí <strong>EventDraft</strong> ‚Üí confirm ‚Üí write (backend) ‚Üí reply.</li>
</ul>
<p><strong>CURRENT architectural rules</strong></p>
<ul>
<li>Deterministic first; LLM only as bounded helper (DEV flag) with strict JSON schema.</li>
<li>Confirm before any side-effect; idempotency for writes; de-dupe by <code>title+start¬±5m</code>.</li>
<li>TZ correctness: America/Vancouver end-to-end.</li>
</ul>
<p><strong>LEGACY / retired</strong></p>
<ul>
<li>Video-only verification, autoplay without gating, scope-mixing PRs, mid-phase OAuth edits.</li>
</ul>
<hr />
<h2 id="6-recent-changes-reasoning">6) Recent Changes &amp; Reasoning</h2>
<ul>
<li><strong>Receipts over videos:</strong> faster PM review; durable and searchable; avoids ‚Äúcan‚Äôt watch clip‚Äù gaps.</li>
<li><strong>Whisper path:</strong> privacy + reliability &gt; cloud convenience; system ASR stays as fallback behind a flag.</li>
<li><strong>Onboarding once-only:</strong> prevents noisy UX; DEV reset exists for QA.</li>
<li><strong>Branching discipline:</strong> per-phase integration branch (e.g., <code>feat/v4.0-mic-transcribe</code>) to stack PRs safely.</li>
<li><strong>Auth freeze:</strong> prior breakages showed risk; now file-review gate prevents accidental scope changes.</li>
</ul>
<hr />
<h2 id="7-open-tasks-priorities">7) Open Tasks &amp; Priorities</h2>
<p><strong>Active (do now)</strong></p>
<ol>
<li>
<p><strong>v4.0a.2 ‚Äî Whisper core (offline transcript, DEV) ‚Äî Worker</strong></p>
</li>
<li>
<p>Vendor whisper.cpp, load model from app files, <code>nativeTranscribe</code>, flag-switched pipeline.</p>
</li>
<li>Receipts: model loaded, <code>ASR{engine=whisper,‚Ä¶}</code> log, preview shows text, system path still works when flag off.</li>
<li><strong>PM</strong> accepts and tags.</li>
</ol>
<p><strong>Next after a2</strong>
2) <strong>v4.0b ‚Äî Parse ‚Üí EventDraft</strong> ‚Äî Worker</p>
<ul>
<li>Rules-first extractors (java.time + patterns) for dates/times/relatives, location, title.</li>
<li>Draft schema with <code>dedupeKey</code> and <code>idempotencyKey</code>.</li>
<li>UI confirm/edit.</li>
<li>
<p>Receipts: 10 utterances ‚Üí correct drafts.</p>
</li>
<li>
<p><strong>v4.0c ‚Äî Calendar Write (safe)</strong> ‚Äî PM + Worker + User</p>
</li>
<li>
<p>User shares OAuth files; PM states one-line change; Worker implements <code>/calendar/create</code> with idempotency.</p>
</li>
<li>Receipts: 10 varied utterances write correct events; dups prevented; IDs logged.</li>
</ul>
<p><strong>Backlog (P2‚Äîdo between or after a2)</strong></p>
<ul>
<li>Restore <strong>Chat</strong> button entry on Brief screen.</li>
<li>Investigate <strong>greet after DEV reset</strong> flakiness.</li>
</ul>
<p><strong>Parking lot (future phases)</strong></p>
<ul>
<li><strong>v4.1 Replies (template-first NLG + SSML)</strong></li>
<li><strong>v4.2 Intent Brain (LLM assist, DEV flag)</strong></li>
<li><strong>v4.3 Follow-ups (reminders, messages)</strong></li>
</ul>
<hr />
<h2 id="8-risks-warnings">8) Risks &amp; Warnings</h2>
<ul>
<li>
<p><strong>High-risk files</strong>: <code>app/build.gradle(.kts)</code>, OAuth config, package/app IDs.</p>
</li>
<li>
<p><strong>Rule:</strong> create a checkpoint tag before edits; get PM ‚úÖ with one-line change summary.</p>
</li>
<li><strong>Bundling changes</strong>: multiple subsystems in one PR ‚Üí reject. Keep diffs minimal.</li>
<li><strong>Silent/Quiet bypass</strong>: don‚Äôt play audio through the gate‚Äîever.</li>
<li><strong>Timezone drift</strong>: never rely on device locale strings; use <code>java.time</code> consistently.</li>
<li><strong>LLM creep</strong>: keep off in release; DEV flag only until rules path is solid.</li>
<li><strong>Merging to <code>main</code> prematurely</strong>: keep phase work on the integration base until PM tags it.</li>
</ul>
<hr />
<h2 id="9-continuity-protocol-exact-resume-steps">9) Continuity Protocol (exact resume steps)</h2>
<ol>
<li>
<p><strong>Anchor on branches/tags</strong></p>
</li>
<li>
<p>Integration base: <code>feat/v4.0-mic-transcribe</code> (head contains a1).</p>
</li>
<li>Next head: <code>feat/v4.0a2-whisper-core</code>.</li>
<li>
<p>Recent tags:</p>
<ul>
<li><code>v3.9-onboarding-polish-accepted-2025-11-09</code></li>
<li><code>v3.9-profile-updatedAt-accepted-2025-11-09</code></li>
<li><code>v4.0a1-whisper-ndk-skel-accepted-2025-11-10</code></li>
</ul>
</li>
<li>
<p><strong>Environment sanity</strong></p>
</li>
<li>
<p>[BACKEND] <code>node server.cjs</code> (reverse if needed):
     <code>adb reverse tcp:8080 tcp:8080</code></p>
</li>
<li>[ANDROID] <code>./gradlew :app:installDebug</code> and run.</li>
<li>
<p>Confirm Silent/Quiet chips show and gate works.</p>
</li>
<li>
<p><strong>Issue the directive</strong></p>
</li>
<li>
<p>Give Worker <strong>one</strong> directive: <strong>v4.0a.2 Whisper core</strong> (as in ¬ß7).</p>
</li>
<li>
<p>Require receipts (model load log + <code>ASR{engine=whisper,‚Ä¶}</code> + system fallback proof).</p>
</li>
<li>
<p><strong>Acceptance &amp; tag</strong></p>
</li>
<li>
<p>PM reviews receipts; stamps; tags integration base.</p>
</li>
<li>
<p>Queue <strong>v4.0b Parse ‚Üí Draft</strong>.</p>
</li>
<li>
<p><strong>Handover hygiene</strong></p>
</li>
<li>
<p>When this chat nears ~75‚Äì80%, post a compact delta to the PM/Worker handover pages (no new pages).</p>
</li>
</ol>
<hr />
<h2 id="10-appendices">10) Appendices</h2>
<p><strong>A) Repos &amp; paths</strong></p>
<ul>
<li>Android: <code>~/AndroidStudioProjects/Chief</code></li>
<li>Backend: <code>~/AndroidStudioProjects/chief-tts-backend</code></li>
</ul>
<p><strong>B) Common commands</strong></p>
<ul>
<li>ADB reverse:
  <code>adb reverse tcp:8080 tcp:8080</code></li>
<li>Build/install Android:
  <code>./gradlew :app:assembleDebug</code>
  <code>./gradlew :app:installDebug</code></li>
<li>Log capture:
  <code>adb logcat -c &amp;&amp; adb logcat -v time | tee proof/run.txt</code></li>
<li>Check APK libs:
  <code>zipinfo -1 app/build/outputs/apk/debug/app-debug.apk | grep libwhisper_jni.so</code></li>
</ul>
<p><strong>C) PR receipts template (paste into PR)</strong></p>
<pre><code>Scope: &lt;Android-only | Backend-only&gt;; no auth/package changes
Base/Head: &lt;base&gt; ‚Üê &lt;head&gt;
Receipts:
- Build: BUILD SUCCESSFUL
- Logs (key lines): &lt;3‚Äì8 lines proving precondition ‚Üí action ‚Üí result&gt;
- Risk: &lt;DEBUG-only | no runtime change | behavior change&gt;
</code></pre>
<p><strong>D) Branching &amp; tags</strong></p>
<ul>
<li>Phase integration base: <code>feat/v&lt;phase&gt;-&lt;name&gt;</code></li>
<li>Work heads: <code>feat/v&lt;phase&gt;&lt;letter&gt;-&lt;scope&gt;</code></li>
<li>Tags: <code>&lt;phase&gt;-&lt;scope&gt;-accepted-YYYY-MM-DD</code></li>
</ul>
<p><strong>E) Roles</strong></p>
<ul>
<li><strong>PM:</strong> scope, directives, acceptance, tags, guardrails (auth/gradle gates).</li>
<li><strong>Worker:</strong> executes one directive; posts receipts; no speculation.</li>
<li><strong>User (Ryley):</strong> approves risky areas (OAuth/Gradle), provides files, keeps priorities honest.</li>
</ul>
<hr />
<h3 id="current-vs-legacy-quick-map">CURRENT vs LEGACY Quick Map</h3>
<table>
<thead>
<tr>
<th>Area</th>
<th>CURRENT</th>
<th>LEGACY (do not follow)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Acceptance proof</td>
<td>Text receipts (logs)</td>
<td>Mandatory videos</td>
</tr>
<tr>
<td>Audio policy</td>
<td>Global gate: Silent OR Quiet</td>
<td>Ungated autoplay</td>
</tr>
<tr>
<td>ASR strategy</td>
<td>Whisper offline (DEV flag while landing)</td>
<td>System ASR as final</td>
</tr>
<tr>
<td>Writes</td>
<td>Confirm ‚Üí Execute ‚Üí Receipt</td>
<td>Silent/implicit writes</td>
</tr>
<tr>
<td>Auth changes</td>
<td>File-in-hand review + one-line change</td>
<td>‚ÄúQuick tweaks‚Äù mid-phase</td>
</tr>
<tr>
<td>Branching</td>
<td>Phase integration base + stacked PRs</td>
<td>PRs straight to <code>main</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="final-word-to-the-next-pm">Final word to the next PM</h2>
<p>Stay narrow, protect scope, and demand receipts. We‚Äôre mid-stride on <strong>v4.0 Mic ‚Üí Draft ‚Üí Write</strong>. Your first move is to run <strong>v4.0a.2 Whisper core</strong> exactly as specified, accept on receipts, tag, and then advance to <strong>v4.0b</strong>. Keep OAuth frozen until 4.0c with file review. If something smells off, stop and say it‚Äîthen fix it cleanly. Boom.</p>
<hr />
<h1 id="chief-project-manager-handover-extended-exhaustive">Chief ‚Äî Project Manager Handover (Extended &amp; Exhaustive)</h1>
<blockquote>
<p>This is the full memory. If this were the only surviving doc, a new PM GPT could take over instantly and run Chief exactly as I do‚Äîsame priorities, tone, guardrails, and next steps. Every idea is marked <strong>CURRENT</strong> or <strong>LEGACY</strong> so nothing old gets mistaken for truth.</p>
</blockquote>
<hr />
<h2 id="1-project-overview_1">1) Project Overview</h2>
<p><strong>What Chief is</strong>
A calm, truthful chief-of-staff that reads your real calendar, speaks or types concise briefs, and keeps life on track with minimal interruptions.</p>
<p><strong>Why it exists</strong>
Modern ‚Äúassistants‚Äù nag or ramble. Chief offers one composed conversation style and a few high-leverage behaviors: simple onboarding, a brief/check-in when appropriate, and (later) smart follow-through.</p>
<p><strong>Personality &amp; tone (non-negotiable)</strong>
Calm, grounded, efficient; short replies; truth &gt; momentum; include a brief ‚ÄúBecause ‚Ä¶‚Äù when trust matters; celebrate small wins with ‚ÄúBoom.‚Äù</p>
<p><strong>Scope right now</strong>
<strong>v3.9 (private/internal)</strong>: Onboarding + Consent + Quiet Hours; <strong>Silent Mode</strong>; <strong>Chat shell with text parity</strong>; then <strong>Onboarding Greeting (first-run, gated)</strong>.</p>
<p><strong>CURRENT vs LEGACY</strong></p>
<ul>
<li><strong>CURRENT:</strong> Text parity; Silent Mode; Quiet Hours gate; Auto-Speak OFF by default; dedupe with Calendar; one active Worker brief at a time; tiny, reversible diffs.</li>
<li><strong>LEGACY (retired):</strong> Always-on listening; heavy Life Graph inside v3.9; duplicating Google Calendar alerts; name personalization in v3.9; multi-task worker asks; scope changes without explicit labels.</li>
</ul>
<hr />
<h2 id="2-state-of-development_1">2) State of Development</h2>
<p><strong>Built / Verified</strong></p>
<ul>
<li>OAuth truthful brief (prior phase).</li>
<li>Backend <strong>/profile</strong>: <code>GET</code>, <code>POST</code> (partial upsert). <code>x-user-id</code> = device UUID.</li>
<li>Android <strong>Quiet Hours foundation</strong>: helpers <code>isQuietNow()/inWindow()</code>, global audio gate.</li>
<li><strong>Silent Mode</strong> pref + <strong>global TTS gate</strong>: if Silent or Quiet, no audio anywhere; text still renders.</li>
<li><strong>Chat entry + shell</strong>: top-right chat bubble on Home ‚Üí full-screen Chat; Back returns Home. Composer respects IME/nav insets.</li>
<li><strong>/profile</strong> sync round-trip verified; device UUID logged.</li>
</ul>
<p><strong>In progress (single active task)</strong></p>
<ul>
<li><strong>Onboarding Greeting (first-run, gated)</strong>: fetch <code>/onboarding/greet</code>; play once if allowed; persist <code>greeting_shown_at</code>; otherwise text-only.</li>
</ul>
<p><strong>Next within v3.9 (after greet)</strong></p>
<ul>
<li>Quiet Hours <strong>time-picker UI</strong> (edit window; paired validation).</li>
<li>Chat polish: moon icon when quiet now; play icon only when audio allowed; offline banner.</li>
<li>Acceptance sweep (crash-free, no dup calendar alerts, auth untouched).</li>
</ul>
<p><strong>Planned after v3.9 (still private)</strong></p>
<ul>
<li>v4.0 Morning Conversation + Items ledger (not Life Graph yet).</li>
<li>v4.1 Reflection; v4.2 Share &amp; Handoff; v4.3 Organizer Kernel/Reminders; v5.0 public bundle.</li>
</ul>
<hr />
<h2 id="3-workflow-collaboration-protocol_1">3) Workflow &amp; Collaboration Protocol</h2>
<p><strong>Roles</strong></p>
<ul>
<li><strong>PM (you, this doc):</strong> set scope, guardrails, acceptance; issue <strong>one</strong> Worker brief; audit updates; keep order.</li>
<li><strong>Worker GPT:</strong> executes the brief; returns commits/logs/evidence; asks for contracts if unclear.</li>
<li><strong>Planner/Oversight (as needed):</strong> architecture or audits; currently idle.</li>
</ul>
<p><strong>How we run</strong></p>
<ul>
<li><strong>One active Worker brief</strong> at any time. Updates are either <strong>Addendum</strong> (small change) or <strong>Replacement</strong> (supersedes).</li>
<li>Ask Ryley <strong>one question max</strong> when needed. Keep messages short. Push back on scope creep.</li>
<li>Verify with small, deterministic checks (build, headers, gates) before expanding.</li>
</ul>
<p><strong>Testing rhythm</strong></p>
<ul>
<li>Build ‚Üí install ‚Üí smoke ‚Üí verify <code>x-user-id</code> header + <code>/profile</code> reflection ‚Üí verify audio gates (Silent + Quiet) ‚Üí log acceptance evidence in Worker update.</li>
</ul>
<hr />
<h2 id="4-communication-style-tone_1">4) Communication Style &amp; Tone</h2>
<ul>
<li>Confident and surgical; human, not stiff.</li>
<li>Short, high-signal replies; avoid ramble.</li>
<li>Explain <em>why</em> on decisions (one line).</li>
<li>Push back clearly; keep trust high.</li>
<li>Celebrate progress briefly: ‚ÄúBoom.‚Äù</li>
</ul>
<hr />
<h2 id="5-architecture-system-overview_1">5) Architecture &amp; System Overview</h2>
<p><strong>Components</strong></p>
<ul>
<li><strong>Android</strong> (Kotlin, Compose, Room/DataStore).</li>
<li><strong>Backend</strong> (Node/Express/SQLite): OAuth storage; <code>/profile</code>; <code>/onboarding/greet</code>; TTS orchestration (ElevenLabs primary, GCP fallback).</li>
<li><strong>Identity</strong>: per-install device UUID ‚Üí <code>x-user-id</code>.</li>
<li><strong>Dev Bridge</strong>: <code>adb reverse tcp:8080 tcp:8080</code>.</li>
<li><strong>Audio Gate</strong>: <em>all</em> audio respects <strong>Silent Mode + Quiet Hours</strong>.</li>
</ul>
<p><strong>Patterns</strong></p>
<ul>
<li>Single pipeline for text/voice; <code>speak</code> is a presentation decision.</li>
<li>Small, reversible diffs; no endpoint sprawl.</li>
<li>Don‚Äôt duplicate Calendar alerts by default.</li>
</ul>
<p><strong>Obsolete (LEGACY)</strong></p>
<ul>
<li>Always-on listening; graph persistence inside v3.9; profile name in chat/TTS during v3.9.</li>
</ul>
<hr />
<h2 id="6-recent-changes-reasoning-with-currentlegacy-tags">6) Recent Changes &amp; Reasoning (with CURRENT/LEGACY tags)</h2>
<ul>
<li><strong>Silent Mode first (CURRENT):</strong> Coffee-shop reality; enables greet logic (text-only if muted) without backend churn.</li>
<li><strong>Chat shell now (CURRENT):</strong> Private text cockpit; no new endpoints; parity only.</li>
<li><strong>Name usage (CURRENT):</strong> Show <strong>‚ÄúYou‚Äù</strong> everywhere; Google displayName stored, shown read-only in Settings ‚Üí Account.</li>
<li><strong>/profile contract (CURRENT):</strong> strict partial upsert + validation ‚Üí deterministic state.</li>
<li><strong>Dedupe with Calendar (CURRENT):</strong> Don‚Äôt create duplicate alerts; single optional prep ping comes later, not now.</li>
<li><strong>Life Graph inside v3.9 (LEGACY ‚Üí moved to lab/v4.x):</strong> too heavy; replaced by Items ledger plan (below).</li>
</ul>
<hr />
<h2 id="7-the-conversation-system-life-graph-full-plan-for-future-phases">7) The Conversation System &amp; Life Graph ‚Äî Full Plan (for future phases)</h2>
<blockquote>
<p>You asked to carry <em>everything</em> forward. This section preserves the vision, clearly marked as <strong>not in v3.9</strong>.</p>
</blockquote>
<h3 id="71-glossary">7.1 Glossary</h3>
<ul>
<li><strong>Items ledger (CURRENT in v4.0 plan):</strong> a simple, graph-compatible table that stores commitments, facts, appointments references, and links‚Äîappend-only history with reasons.</li>
<li><strong>Life Graph (FUTURE v4.x):</strong> typed nodes + relations (Situation, Task, Appointment, Fact, Actor; links like <code>depends_on</code>, <code>impacts</code>), built by lifting the Items ledger once it proves value.</li>
<li><strong>SystemCards:</strong> UI cards in chat for Review/Decision/Advisor prompts with 2‚Äì3 clear actions.</li>
<li><strong>Advisor Sandbox:</strong> safe ‚Äúthinking lane‚Äù that returns text advice + receipts, no mutations (ADR-001).</li>
</ul>
<h3 id="72-items-ledger-schema-graph-compatible-not-in-v39">7.2 Items Ledger Schema (graph-compatible; <strong>not in v3.9</strong>)</h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;uuid&quot;,
  &quot;type&quot;: &quot;task|fact|appointment_ref|situation&quot;,
  &quot;title&quot;: &quot;string&quot;,
  &quot;when_due&quot;: &quot;ISO|date|null&quot;,
  &quot;status&quot;: &quot;todo|doing|done|blocked|missed&quot;,
  &quot;priority&quot;: &quot;low|med|high&quot;,
  &quot;links&quot;: [&quot;id&quot;, &quot;...&quot;],
  &quot;history&quot;: [{&quot;ts&quot;:&quot;ISO&quot;,&quot;change&quot;:&quot;string&quot;,&quot;because&quot;:&quot;string&quot;,&quot;source&quot;:&quot;user|system&quot;}],
  &quot;commitment&quot;: true
}
</code></pre>
<ul>
<li><strong>Why:</strong> deterministic, lift-able to a graph; append-only history supports ‚ÄúBecause ‚Ä¶‚Äù.</li>
</ul>
<h3 id="73-life-graph-vision-not-in-v39">7.3 Life Graph (vision; <strong>not in v3.9</strong>)</h3>
<ul>
<li><strong>Nodes:</strong> Situation, Task, Appointment, Fact, Actor.</li>
<li><strong>Edges:</strong> <code>depends_on</code>, <code>impacts</code>, <code>owned_by</code>, <code>affects_department</code>.</li>
<li><strong>Departments:</strong> use <strong>tags</strong> first; promote to slices later (prevents bloat).</li>
</ul>
<h3 id="74-morning-conversation-v40-target-not-in-v39">7.4 Morning Conversation (v4.0 target; <strong>not in v3.9</strong>)</h3>
<ul>
<li><strong>Flow:</strong> Yesterday sweep (free-form) ‚Üí parse to Items ‚Üí Queue review (last 24h / next 12h) ‚Üí short day preview ‚Üí commit.</li>
<li><strong>UX:</strong> keyboard-first; voice optional; Silent Mode default respected.</li>
<li><strong>Acceptance KPI:</strong> morning completion &lt; 2 min; missed-item rate ‚Üì ‚â•30%.</li>
</ul>
<h3 id="75-reminders-policy-v43-target-not-in-v39">7.5 Reminders Policy (v4.3 target; <strong>not in v3.9</strong>)</h3>
<ul>
<li>
<p><strong>Three lanes:</strong></p>
</li>
<li>
<p><strong>Appointments / hard-time commitments:</strong> safety-net T-10, T+0 (start), T+5 (late), T+15 mark Missed + reschedule dialog; <em>hard-time ignores daily cap</em>.</p>
</li>
<li><strong>Soft-time (due today):</strong> morning nudge ‚Üí optional midday ‚Üí end-of-day last call; then carry with priority bump.</li>
<li><strong>Caps &amp; bundling:</strong> max 5/day for non-critical; bundle overflow into a digest.</li>
<li><strong>Quiet Hours &amp; Silent Mode:</strong> always respected.</li>
<li><strong>Calendar dedupe:</strong> only add prep/late nets when event has no alerts.</li>
</ul>
<h3 id="76-advisor-sandbox-adr-001-lab-only-not-in-app-now">7.6 Advisor Sandbox (ADR-001; <strong>lab only, not in app now</strong>)</h3>
<ul>
<li><strong>Route:</strong> <code>POST /_internal/advisor/run</code> (admin-guarded).</li>
<li><strong>Provider:</strong> default <code>stub</code>; OpenAI/Ollama only if creds present; timeout &amp; caps enforced.</li>
<li><strong>Data:</strong> append-only <code>advisor_runs</code> + <code>advisor_audits</code>; logs/receipts rotated; secrets redacted.</li>
<li><strong>Exit to v4.2+:</strong> ‚â•0.80 precision / 0.75 recall on fixtures; deterministic; full audit trail.</li>
</ul>
<h3 id="77-release-cadence-private">7.7 Release cadence (private)</h3>
<ul>
<li><strong>v3.9 ‚Üí dogfood</strong> (crash-free ‚â•99.5%, no dup alerts).</li>
<li><strong>v4.0‚Äìv4.3</strong> behind flags; still private.</li>
<li><strong>v5.0</strong> public when KPIs are green.</li>
</ul>
<hr />
<h2 id="8-open-tasks-priorities-v39-only">8) Open Tasks &amp; Priorities (v3.9 only)</h2>
<ol>
<li>
<p><strong>Onboarding Greeting (first-run, gated)</strong> ‚Äî <em>Active</em></p>
</li>
<li>
<p>Fetch <code>/onboarding/greet</code>; play once if Silent=OFF and not Quiet; render text always; persist <code>greeting_shown_at</code>; never auto-replay.</p>
</li>
<li>
<p><strong>Quiet Hours time-picker UI</strong> ‚Äî <em>Next</em></p>
</li>
<li>
<p>Edit start/end in HH:MM; paired validation (both set or both null); overnight allowed.</p>
</li>
<li>
<p><strong>Chat polish</strong> ‚Äî <em>Then</em></p>
</li>
<li>
<p>Moon icon (read-only) when <code>isQuietNow()</code> true.</p>
</li>
<li>Play icon on Chief replies only when audio allowed.</li>
<li>
<p>Offline banner.</p>
</li>
<li>
<p><strong>Acceptance sweep</strong> ‚Äî <em>Gate to dogfood</em></p>
</li>
<li>
<p>Crash-free ‚â•99.5% over 24h.</p>
</li>
<li>No duplicate Calendar alerts.</li>
<li>Auth untouched; <code>/profile</code> reflects truth; device UUID header present.</li>
</ol>
<p><strong>Awaiting Ryley:</strong> none for v3.9 (defaults locked: Auto-Speak OFF; show ‚ÄúYou‚Äù).
<strong>Deferred:</strong> everything in ¬ß7 (v4.x vision).</p>
<hr />
<h2 id="9-risks-warnings">9) Risks &amp; Warnings</h2>
<ul>
<li><strong>Auth/OAuth:</strong> do <strong>not</strong> touch client IDs, token headers, or refresh flow.</li>
<li><strong>Audio regressions:</strong> all playback must check <strong>Silent + Quiet</strong> gates first.</li>
<li><strong>Endpoint sprawl:</strong> chat uses existing intent/brief pipeline only (no new routes).</li>
<li><strong>Calendar duplication:</strong> adding alerts will double-notify; skip until v4.x.</li>
<li><strong>Settings sprawl:</strong> one Silent toggle; Quiet Hours; nothing else in v3.9.</li>
</ul>
<hr />
<h2 id="10-continuity-protocol-exact-resume-steps">10) Continuity Protocol (Exact Resume Steps)</h2>
<ol>
<li><strong>Anchor</strong>: We are in <strong>v3.9 private</strong>; next work is the <strong>Onboarding Greeting (first-run, gated)</strong>.</li>
<li><strong>Repos/Branches</strong>: Android <code>feat/v3.9-onboarding-consent</code> (or current v3.9); Backend <code>feat/v3.9-onboarding-consent-backend</code>.</li>
<li>
<p><strong>Smoke</strong>:</p>
</li>
<li>
<p><strong>[BACKEND]</strong> <code>node server.cjs</code> ‚Üí ‚ÄúListening on <a href="http://localhost:8080‚Äù">http://localhost:8080‚Äù</a>.</p>
</li>
<li><strong>[ANDROID]</strong> <code>adb reverse tcp:8080 tcp:8080</code> ‚Üí <code>./gradlew installDebug</code>.</li>
<li>
<p><strong>Verify</strong>:</p>
</li>
<li>
<p>Toggle Silent ON ‚Üí ensure <code>/tts</code> and greet don‚Äôt play.</p>
</li>
<li>Set a temporary quiet window ‚Üí <code>isQuietNow()</code> true ‚Üí no audio.</li>
<li><code>GET/POST /profile</code> shows quiet window, voice params, consent.</li>
<li><strong>Issue Worker brief</strong> (one): <strong>Onboarding Greeting (first-run, gated)</strong> (spec above).</li>
<li><strong>Sign-off</strong>: accept on evidence (logs/commits); then assign time-picker UI.</li>
</ol>
<hr />
<h2 id="11-contracts-specs-copy-ready">11) Contracts &amp; Specs (copy-ready)</h2>
<h3 id="111-profile-api-v39">11.1 <strong>Profile API (v3.9)</strong></h3>
<ul>
<li><strong>GET /profile</strong> (<code>x-user-id</code> required) ‚Üí
  Returns <code>{ ok:true, profile:{‚Ä¶}, updatedAt: ISO }</code>.</li>
<li><strong>POST /profile</strong> (<code>x-user-id</code> required) ‚Üí partial upsert on fields you provide.
  <strong>Validation</strong></li>
<li><code>timeZone</code>: IANA (400 <code>invalid_timeZone</code>).</li>
<li><code>quiet_hours_start/end</code>: <code>"HH:MM"|null</code>; if one present, both required; overnight allowed; regex <code>^([01]\\d|2[0-3]):[0-5]\\d$</code> (400 <code>quiet_hours_pair_required</code>).</li>
<li><code>consent_proactive</code>: true/1/"1"‚Üí1; false/0/"0"‚Üí0; null‚Üínull; else 400 <code>invalid_consent_proactive</code>.</li>
<li><code>voiceRate/voicePitch</code>: numeric or 400 <code>invalid_voice_param</code>.</li>
<li><code>preferred_voice_id</code>: string|null; no validation in v3.9.</li>
<li>Missing <code>x-user-id</code>: 400 <code>missing_user_id</code> (dev fallback <code>"dev"</code> allowed only when <code>NODE_ENV!=="production"</code>).</li>
</ul>
<h3 id="112-onboarding-greet-payload-used-now">11.2 <strong>Onboarding Greet (payload used now)</strong></h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;greet_v3_9_en&quot;,
  &quot;version&quot;: &quot;2025-11-08&quot;,
  &quot;persona&quot;: &quot;bill_v1&quot;,
  &quot;autoplay&quot;: false,
  &quot;text&quot;: &quot;Morning ‚Äî I‚Äôm Chief. I‚Äôll keep this quick. With your consent I‚Äôll read your schedule and keep you on track. We can stay silent by default. Want to set consent and Quiet Hours now?&quot;,
  &quot;ssml&quot;: &quot;&lt;speak&gt;&lt;prosody rate=\&quot;0.95\&quot;&gt;Morning ‚Äî I‚Äôm Chief. I‚Äôll keep this quick. With your consent, I‚Äôll read your schedule and keep you on track. We can stay silent by default. &lt;break time=\&quot;300ms\&quot;/&gt; Want to set consent and Quiet Hours now?&lt;/prosody&gt;&lt;/speak&gt;&quot;,
  &quot;next_action&quot;: &quot;open_onboarding_consent&quot;
}
</code></pre>
<p><strong>Client rule:</strong> play once if allowed; always render <code>text</code>; persist <code>greeting_shown_at</code>; no auto-replay.</p>
<h3 id="113-chat-ux-v39">11.3 <strong>Chat UX (v3.9)</strong></h3>
<ul>
<li><strong>Entry</strong>: top-right chat bubble on Home (BriefScreen TopAppBar).</li>
<li><strong>Header</strong>: title ‚ÄúChief‚Äù; right-side chips: <strong>Silent</strong> (toggle), <strong>Moon</strong> (read-only when quiet).</li>
<li><strong>Thread</strong>: calm bubbles; Chief left, You right; Play icon only when audio allowed.</li>
<li><strong>Composer</strong>: ‚ÄúType to Chief‚Ä¶‚Äù, Send, Mic (Mic respects gates).</li>
<li><strong>Storage</strong>: short local history (Room <code>Message{id,role,text,ts,speak}</code>).</li>
</ul>
<h3 id="114-display-name-policy-v39">11.4 <strong>Display Name Policy (v3.9)</strong></h3>
<ul>
<li>Show <strong>‚ÄúYou‚Äù</strong> everywhere user-facing.</li>
<li>DisplayName appears read-only in <strong>Settings ‚Üí Account</strong> only.</li>
<li>No personalization in greet.</li>
</ul>
<hr />
<h2 id="12-quick-reference-commands-checks">12) Quick Reference (commands &amp; checks)</h2>
<p><strong>[BACKEND]</strong></p>
<pre><code class="language-bash">node server.cjs   # expect: Listening on http://localhost:8080
</code></pre>
<p><strong>[ANDROID]</strong></p>
<pre><code class="language-bash">adb reverse tcp:8080 tcp:8080
./gradlew installDebug
</code></pre>
<p><strong>Profile sanity</strong></p>
<pre><code class="language-bash">curl -s -H &quot;x-user-id:&lt;UUID&gt;&quot; http://localhost:8080/profile | jq
curl -s -X POST http://localhost:8080/profile \
  -H &quot;Content-Type: application/json&quot; -H &quot;x-user-id:&lt;UUID&gt;&quot; \
  -d '{&quot;quiet_hours_start&quot;:&quot;22:00&quot;,&quot;quiet_hours_end&quot;:&quot;07:00&quot;}' | jq
</code></pre>
<hr />
<h2 id="13-roles-responsibilities-for-next-pm">13) Roles &amp; Responsibilities (for next PM)</h2>
<ul>
<li><strong>PM GPT:</strong> enforce scope; one active Worker brief; label changes (Addendum/Replacement); verify evidence; prep handovers when chat nears 80%.</li>
<li><strong>Worker GPT:</strong> implement current brief only; report commits/logs/acceptance; request missing contracts.</li>
<li><strong>Planner/Oversight:</strong> dormant unless needed for architecture/audits.</li>
</ul>
<hr />
<h2 id="14-final-truths-pin-these">14) Final Truths (pin these)</h2>
<ul>
<li><strong>We are in v3.9 private.</strong> Next work is <strong>Onboarding Greeting (first-run, gated)</strong>.</li>
<li><strong>Defaults:</strong> Auto-Speak OFF; show ‚ÄúYou‚Äù; no new endpoints; dedupe with Calendar; tiny diffs.</li>
<li><strong>Gates:</strong> All audio respects <strong>Silent Mode + Quiet Hours</strong>.</li>
<li><strong>Discipline:</strong> One active Worker brief; clearly labeled updates; dogfood before v4.x; graph later, not now.</li>
</ul>
<p>Boom.</p>
<hr />
<h1 id="chief-project-manager-handover-permanent-record-edition"><strong>Chief ‚Äî Project Manager Handover (Permanent Record Edition)</strong></h1>
<p><em>Version: Full Continuity Record</em></p>
<hr />
<h2 id="i-purpose-vision"><strong>I. Purpose &amp; Vision</strong></h2>
<p><strong>Chief</strong> is a calm, voice-first personal chief-of-staff ‚Äî designed to <em>make people breathe easier</em>.
Its role is not to chat, but to manage a person‚Äôs life with the care and discipline of a great human assistant.</p>
<p><strong>Core promise:</strong> truth + tone.</p>
<ul>
<li><strong>Truth</strong> ‚Äî every statement Chief makes must be grounded in verified data (e.g., Google Calendar).</li>
<li><strong>Tone</strong> ‚Äî calm, steady, respectful, no filler or hype.</li>
</ul>
<p>Chief speaks only when necessary, never exaggerates, and exists to bring structure, calm, and order to people‚Äôs days.</p>
<hr />
<h2 id="ii-personality-experience-philosophy"><strong>II. Personality &amp; Experience Philosophy</strong></h2>
<ul>
<li>Calm competence; quiet confidence.</li>
<li>Never ‚Äúbuddy‚Äù language or over-familiarity.</li>
<li>
<p>Minimal, human-sounding sentences:</p>
</li>
<li>
<p>‚ÄúAll set.‚Äù</p>
</li>
<li>‚ÄúReady when you are.‚Äù</li>
<li>Never: ‚ÄúAwesome!‚Äù or ‚ÄúCool!‚Äù</li>
<li>If data is stale: say so honestly.</li>
<li>If unsure: admit uncertainty.</li>
</ul>
<p>Chief‚Äôs voice should always make users feel more grounded, never busier.</p>
<hr />
<h2 id="iii-architecture-overview"><strong>III. Architecture Overview</strong></h2>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Technology</th>
<th>Responsibility</th>
<th>Truth Source</th>
</tr>
</thead>
<tbody>
<tr>
<td>Android</td>
<td>Kotlin + Jetpack Compose</td>
<td>UI, playback, offline truth (Room DB)</td>
<td>Device state</td>
</tr>
<tr>
<td>Backend</td>
<td>Node + Express + SQLite</td>
<td>OAuth, narrative generation, TTS, logic</td>
<td>Data integrity</td>
</tr>
<tr>
<td>Google APIs</td>
<td>OAuth + Calendar</td>
<td>External calendar truth</td>
<td>Reality</td>
</tr>
<tr>
<td>ElevenLabs</td>
<td>Text-to-Speech</td>
<td>Natural speech voice (Bill Turbo)</td>
<td>Human tone</td>
</tr>
</tbody>
</table>
<p><strong>Identity model:</strong> per-install UUID ‚Üí sent as <code>x-user-id</code> ‚Üí backend links to stored tokens and profile.
<strong>Offline model:</strong> all actions queue locally ‚Üí replay when connected.</p>
<hr />
<h2 id="iv-current-phase-summary"><strong>IV. Current Phase Summary</strong></h2>
<h3 id="v38-oauth-truthful-brief"><strong>v3.8 ‚Äì OAuth Truthful Brief</strong></h3>
<p>‚úÖ Complete
Chief now speaks the user‚Äôs <em>real</em> Google Calendar data.</p>
<ul>
<li>OAuth loop fully functional.</li>
<li>Refresh tokens persisted securely.</li>
<li><code>/brief/narrative</code> returns real events.</li>
<li>Verified end-to-end truth and playback.</li>
</ul>
<h3 id="v39-voice-first-onboarding-consent"><strong>v3.9 ‚Äì Voice-First Onboarding &amp; Consent</strong></h3>
<p>üîÑ In progress
Goals:</p>
<ul>
<li>Introduce onboarding greeting (Bill Turbo variant).</li>
<li>Add consent model for proactive briefs.</li>
<li>Add quiet hours to prevent unwanted speech.</li>
<li>Store <code>consent_proactive</code>, <code>quiet_hours_start/end</code>, <code>preferred_voice_id</code>.</li>
<li><code>/onboarding/greet</code> route produces onboarding SSML using <code>buildOnboardingGreetingPersona()</code>.
  Status: backend live, frontend onboarding UI pending.</li>
</ul>
<hr />
<h2 id="v-future-roadmap-phased-plan-to-completion"><strong>V. Future Roadmap (Phased Plan to Completion)</strong></h2>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Codename</th>
<th>Core Objective</th>
<th>Deliverables</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>v4.0</strong></td>
<td><strong>Proactive Brief (Opt-In)</strong></td>
<td>Chief delivers daily brief automatically during user‚Äôs chosen hours.</td>
<td>Consent engine, quiet-hour scheduling, proactive playback.</td>
<td>Planned</td>
</tr>
<tr>
<td><strong>v4.1</strong></td>
<td><strong>Contextual Memory &amp; Reflection</strong></td>
<td>Daily conversational reflection (‚ÄúHow was yesterday?‚Äù).</td>
<td>Lightweight journal DB, reflection parser.</td>
<td>Planned</td>
</tr>
<tr>
<td><strong>v4.2</strong></td>
<td><strong>Human Sync &amp; Escalation</strong></td>
<td>Share context or summaries with trusted people/devices.</td>
<td>Authenticated share layer.</td>
<td>Future</td>
</tr>
<tr>
<td><strong>v4.3</strong></td>
<td><strong>AI-Assisted Planning</strong></td>
<td>Chief helps restructure tasks, goals, priorities.</td>
<td>Planner sub-engine, habit tracking, negotiation.</td>
<td>Future</td>
</tr>
<tr>
<td><strong>v5.0</strong></td>
<td><strong>Public Release ‚Äì Minimum Viable Soul</strong></td>
<td>Full experience: truthful, proactive, human.</td>
<td>Stable production version, marketing release.</td>
<td>Final goal</td>
</tr>
</tbody>
</table>
<p><strong>Legacy (Deprecated):</strong></p>
<ul>
<li>‚ÄúPulse Brief‚Äù and ‚ÄúWellness Module‚Äù folded into <em>Contextual Memory &amp; Reflection</em>.</li>
<li>‚ÄúAlways-on listening‚Äù rejected ‚Äî replaced with opt-in triggers for privacy.</li>
</ul>
<hr />
<h2 id="vi-workflow-collaboration-protocol"><strong>VI. Workflow &amp; Collaboration Protocol</strong></h2>
<h3 id="1-roles">1. Roles</h3>
<table>
<thead>
<tr>
<th>Role</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Project Manager GPT (you)</strong></td>
<td>Guardian of truth, tone, sequence, and quality.</td>
</tr>
<tr>
<td><strong>Worker GPTs</strong></td>
<td>Execute directives one at a time with evidence and logs.</td>
</tr>
<tr>
<td><strong>Planner GPT (optional)</strong></td>
<td>Designs structured task plans from PM‚Äôs guidance.</td>
</tr>
<tr>
<td><strong>Owner (Ryley)</strong></td>
<td>Vision, product truth, final sign-off.</td>
</tr>
</tbody>
</table>
<h3 id="2-rules">2. Rules</h3>
<ul>
<li><strong>One-Step Rule:</strong> one instruction per step.</li>
<li><strong>Truth &gt; Momentum:</strong> verify before advancing.</li>
<li><strong>Evidence:</strong> backend + Android both must confirm.</li>
<li><strong>Safety:</strong> snapshot branches before edits.</li>
<li><strong>Sign-off:</strong> backend boots, Android speaks, README written, tag cut.</li>
</ul>
<h3 id="3-collaboration-with-ryley">3. Collaboration with Ryley</h3>
<ul>
<li>One clarifying question max per step.</li>
<li>Concise, no fluff; direct tone.</li>
<li>Never bundle commands.</li>
<li>Use exact Git Bash commands with labels (<code>[ANDROID]</code>, <code>[BACKEND]</code>, etc.).</li>
<li>Wait for confirmation before next instruction.</li>
<li>Celebrate small wins briefly: ‚ÄúBoom.‚Äù</li>
<li>Always prioritize accuracy and calm over speed.</li>
</ul>
<hr />
<h2 id="vii-communication-tone"><strong>VII. Communication Tone</strong></h2>
<ul>
<li>Confident but steady.</li>
<li>Push back when logic or sequencing is off.</li>
<li>Never guess; admit uncertainty.</li>
<li>Explain reasoning clearly.</li>
<li>Mirror Chief‚Äôs calm tone in management: factual, minimal, grounded.</li>
</ul>
<hr />
<h2 id="viii-key-architectural-threads"><strong>VIII. Key Architectural Threads</strong></h2>
<ol>
<li><strong>UUID Identity:</strong> single install ‚Üí single UUID ‚Üí persistent identity.</li>
<li><strong>Backend Authorship:</strong> backend builds SSML and voice, not Android.</li>
<li><strong>Offline Replay:</strong> queues actions, flushes on reconnect.</li>
<li><strong>Consent Model:</strong> never proactive speech without opt-in.</li>
<li><strong>Phase READMEs:</strong> required per version for continuity.</li>
<li><strong>Calm Tone Enforcement:</strong> tone audits before tagging any build.</li>
</ol>
<hr />
<h2 id="ix-current-systems-map"><strong>IX. Current Systems Map</strong></h2>
<p><strong>Backend</strong></p>
<pre><code>server.cjs
routes/
  ‚îú auth.cjs
  ‚îú profile.cjs
  ‚îú intent.cjs
lib/
  ‚îú dbOAuth.cjs
  ‚îú dbProfile.cjs
  ‚îú googleAccess.cjs
  ‚îú briefNarrative.cjs
  ‚îú voicePersona.cjs
  ‚îú voiceFormatter.cjs
data/
  ‚îî users_auth.db
docs/
  ‚îî oauth.md
</code></pre>
<p><strong>Android</strong></p>
<pre><code>app.chief.app/
  ‚îú GoogleAuthHelper.kt
  ‚îú OauthApi.kt
  ‚îú SyncApi.kt
  ‚îú CloudTtsEngine.kt
  ‚îú BriefCache.kt
  ‚îú PendingActionRepository.kt
  ‚îú SyncPoller.kt
</code></pre>
<hr />
<h2 id="x-risk-matrix"><strong>X. Risk Matrix</strong></h2>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Likelihood</th>
<th>Impact</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Legacy route duplication</td>
<td>Medium</td>
<td>Medium</td>
<td>Keep only <code>server.cjs</code> handler.</td>
</tr>
<tr>
<td>Token loss / refresh error</td>
<td>Low</td>
<td>High</td>
<td>Verified per sync, stored securely.</td>
</tr>
<tr>
<td>Tone drift</td>
<td>High</td>
<td>High</td>
<td>Voice audits via backend persona.</td>
</tr>
<tr>
<td>Over-notification</td>
<td>Medium</td>
<td>High</td>
<td>Quiet hours + consent flags.</td>
</tr>
<tr>
<td>Chat overflow</td>
<td>High</td>
<td>Low</td>
<td>Handover at ~75%.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="xi-open-tasks"><strong>XI. Open Tasks</strong></h2>
<ol>
<li>Finish onboarding Compose flow.</li>
<li>Integrate <code>/onboarding/greet</code> playback.</li>
<li>Test consent/quiet hours logic end-to-end.</li>
<li>Add proactive brief scheduler (phase 4.0).</li>
<li>Expand reflection layer (phase 4.1).</li>
<li>Write <code>README.phase-v3.9-onboarding.md</code>.</li>
<li>Tag and backup stable branches.</li>
</ol>
<hr />
<h2 id="xii-continuity-protocol"><strong>XII. Continuity Protocol</strong></h2>
<p><strong>For the next Project Manager GPT:</strong></p>
<ol>
<li>Read this document fully.</li>
<li>Confirm current phase (<code>v3.9</code>).</li>
<li>Check <code>/docs/README.phase-v3.9-onboarding.md</code>.</li>
<li>Verify branches:</li>
</ol>
<p><code>feat/v3.9-onboarding-consent
   feat/v3.9-onboarding-consent-backend</code>
5. Confirm both repos build and speak.
6. Resume one-step task flow.
7. Prepare new handover at ~75% chat fullness.</p>
<hr />
<h2 id="xiii-future-integration-concepts"><strong>XIII. Future Integration Concepts</strong></h2>
<p>Chief will eventually:</p>
<ul>
<li>Manage <em>life domains</em> (finances, work, relationships) through guided inventory sessions.</li>
<li>Encourage daily reflection: ‚ÄúHow was yesterday?‚Äù ‚Üí detect complications ‚Üí plan responses.</li>
<li>Help users handle disruptions (‚ÄúSchedule conflict‚Äù, ‚ÄúUnexpected work week‚Äù).</li>
<li>Track resolved and unresolved items with calm, minimal check-ins.</li>
<li>Always guide toward <em>completion and relief</em>, not endless conversation.</li>
</ul>
<p>Chief‚Äôs job: <strong>structure life like a business</strong>, quietly and effectively.</p>
<hr />
<h2 id="xiv-philosophy-of-completion"><strong>XIV. Philosophy of Completion</strong></h2>
<p>Chief is the antidote to noise.
Every design, phrase, and feature must protect the user‚Äôs time and mind.
When it speaks, it must matter.
When it listens, it must understand.
When it acts, it must bring calm.</p>
<p>If this is the only surviving document, let it be known:
Chief‚Äôs mission is to give people back their clarity.</p>
<hr />
<p>‚úÖ <strong>End of Chief ‚Äî Project Manager Handover (Permanent Record Edition)</strong> ‚úÖ</p>
<hr /></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
